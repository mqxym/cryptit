var Jt=Object.create;var{getPrototypeOf:Xt,defineProperty:Z,getOwnPropertyNames:MA,getOwnPropertyDescriptor:Yt}=Object,dA=Object.prototype.hasOwnProperty;var BA=(A,t,n)=>{n=A!=null?Jt(Xt(A)):{};let r=t||!A||!A.__esModule?Z(n,"default",{value:A,enumerable:!0}):n;for(let j of MA(A))if(!dA.call(r,j))Z(r,j,{get:()=>A[j],enumerable:!0});return r},bA=new WeakMap,pA=(A)=>{var t=bA.get(A),n;if(t)return t;if(t=Z({},"__esModule",{value:!0}),A&&typeof A==="object"||typeof A==="function")MA(A).map((r)=>!dA.call(t,r)&&Z(t,r,{get:()=>A[r],enumerable:!(n=Yt(A,r))||n.enumerable}));return bA.set(A,t),t},wA=(A,t)=>()=>(t||A((t={exports:{}}).exports,t),t.exports);var Qt=(A,t)=>{for(var n in t)Z(A,n,{get:t[n],enumerable:!0,configurable:!0,set:(r)=>t[n]=()=>r})};var Zt=(A,t)=>()=>(A&&(t=A(A=0)),t);var PA=((A)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(A,{get:(t,n)=>(typeof require!=="undefined"?require:t)[n]}):A)(function(A){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+A+'" is not supported')});var KA={};Qt(KA,{sep:()=>kt,resolve:()=>aA,relative:()=>rt,posix:()=>vt,parse:()=>st,normalize:()=>TA,join:()=>nt,isAbsolute:()=>tt,format:()=>ot,extname:()=>ft,dirname:()=>et,delimiter:()=>ct,default:()=>Mt,basename:()=>it,_makeLong:()=>jt});function $(A){if(typeof A!=="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(A))}function At(A,t){var n="",r=0,j=-1,e=0,f;for(var o=0;o<=A.length;++o){if(o<A.length)f=A.charCodeAt(o);else if(f===47)break;else f=47;if(f===47){if(j===o-1||e===1);else if(j!==o-1&&e===2){if(n.length<2||r!==2||n.charCodeAt(n.length-1)!==46||n.charCodeAt(n.length-2)!==46){if(n.length>2){var c=n.lastIndexOf("/");if(c!==n.length-1){if(c===-1)n="",r=0;else n=n.slice(0,c),r=n.length-1-n.lastIndexOf("/");j=o,e=0;continue}}else if(n.length===2||n.length===1){n="",r=0,j=o,e=0;continue}}if(t){if(n.length>0)n+="/..";else n="..";r=2}}else{if(n.length>0)n+="/"+A.slice(j+1,o);else n=A.slice(j+1,o);r=o-j-1}j=o,e=0}else if(f===46&&e!==-1)++e;else e=-1}return n}function bt(A,t){var n=t.dir||t.root,r=t.base||(t.name||"")+(t.ext||"");if(!n)return r;if(n===t.root)return n+r;return n+A+r}function aA(){var A="",t=!1,n;for(var r=arguments.length-1;r>=-1&&!t;r--){var j;if(r>=0)j=arguments[r];else{if(n===void 0)n=process.cwd();j=n}if($(j),j.length===0)continue;A=j+"/"+A,t=j.charCodeAt(0)===47}if(A=At(A,!t),t)if(A.length>0)return"/"+A;else return"/";else if(A.length>0)return A;else return"."}function TA(A){if($(A),A.length===0)return".";var t=A.charCodeAt(0)===47,n=A.charCodeAt(A.length-1)===47;if(A=At(A,!t),A.length===0&&!t)A=".";if(A.length>0&&n)A+="/";if(t)return"/"+A;return A}function tt(A){return $(A),A.length>0&&A.charCodeAt(0)===47}function nt(){if(arguments.length===0)return".";var A;for(var t=0;t<arguments.length;++t){var n=arguments[t];if($(n),n.length>0)if(A===void 0)A=n;else A+="/"+n}if(A===void 0)return".";return TA(A)}function rt(A,t){if($(A),$(t),A===t)return"";if(A=aA(A),t=aA(t),A===t)return"";var n=1;for(;n<A.length;++n)if(A.charCodeAt(n)!==47)break;var r=A.length,j=r-n,e=1;for(;e<t.length;++e)if(t.charCodeAt(e)!==47)break;var f=t.length,o=f-e,c=j<o?j:o,u=-1,q=0;for(;q<=c;++q){if(q===c){if(o>c){if(t.charCodeAt(e+q)===47)return t.slice(e+q+1);else if(q===0)return t.slice(e+q)}else if(j>c){if(A.charCodeAt(n+q)===47)u=q;else if(q===0)u=0}break}var x=A.charCodeAt(n+q),W=t.charCodeAt(e+q);if(x!==W)break;else if(x===47)u=q}var y="";for(q=n+u+1;q<=r;++q)if(q===r||A.charCodeAt(q)===47)if(y.length===0)y+="..";else y+="/..";if(y.length>0)return y+t.slice(e+u);else{if(e+=u,t.charCodeAt(e)===47)++e;return t.slice(e)}}function jt(A){return A}function et(A){if($(A),A.length===0)return".";var t=A.charCodeAt(0),n=t===47,r=-1,j=!0;for(var e=A.length-1;e>=1;--e)if(t=A.charCodeAt(e),t===47){if(!j){r=e;break}}else j=!1;if(r===-1)return n?"/":".";if(n&&r===1)return"//";return A.slice(0,r)}function it(A,t){if(t!==void 0&&typeof t!=="string")throw new TypeError('"ext" argument must be a string');$(A);var n=0,r=-1,j=!0,e;if(t!==void 0&&t.length>0&&t.length<=A.length){if(t.length===A.length&&t===A)return"";var f=t.length-1,o=-1;for(e=A.length-1;e>=0;--e){var c=A.charCodeAt(e);if(c===47){if(!j){n=e+1;break}}else{if(o===-1)j=!1,o=e+1;if(f>=0)if(c===t.charCodeAt(f)){if(--f===-1)r=e}else f=-1,r=o}}if(n===r)r=o;else if(r===-1)r=A.length;return A.slice(n,r)}else{for(e=A.length-1;e>=0;--e)if(A.charCodeAt(e)===47){if(!j){n=e+1;break}}else if(r===-1)j=!1,r=e+1;if(r===-1)return"";return A.slice(n,r)}}function ft(A){$(A);var t=-1,n=0,r=-1,j=!0,e=0;for(var f=A.length-1;f>=0;--f){var o=A.charCodeAt(f);if(o===47){if(!j){n=f+1;break}continue}if(r===-1)j=!1,r=f+1;if(o===46){if(t===-1)t=f;else if(e!==1)e=1}else if(t!==-1)e=-1}if(t===-1||r===-1||e===0||e===1&&t===r-1&&t===n+1)return"";return A.slice(t,r)}function ot(A){if(A===null||typeof A!=="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof A);return bt("/",A)}function st(A){$(A);var t={root:"",dir:"",base:"",ext:"",name:""};if(A.length===0)return t;var n=A.charCodeAt(0),r=n===47,j;if(r)t.root="/",j=1;else j=0;var e=-1,f=0,o=-1,c=!0,u=A.length-1,q=0;for(;u>=j;--u){if(n=A.charCodeAt(u),n===47){if(!c){f=u+1;break}continue}if(o===-1)c=!1,o=u+1;if(n===46){if(e===-1)e=u;else if(q!==1)q=1}else if(e!==-1)q=-1}if(e===-1||o===-1||q===0||q===1&&e===o-1&&e===f+1){if(o!==-1)if(f===0&&r)t.base=t.name=A.slice(1,o);else t.base=t.name=A.slice(f,o)}else{if(f===0&&r)t.name=A.slice(1,e),t.base=A.slice(1,o);else t.name=A.slice(f,e),t.base=A.slice(f,o);t.ext=A.slice(e,o)}if(f>0)t.dir=A.slice(0,f-1);else if(r)t.dir="/";return t}var kt="/",ct=":",vt,Mt;var OA=Zt(()=>{vt=((A)=>(A.posix=A,A))({resolve:aA,normalize:TA,isAbsolute:tt,join:nt,relative:rt,_makeLong:jt,dirname:et,basename:it,extname:ft,format:ot,parse:st,sep:kt,delimiter:ct,win32:null,posix:null}),Mt=vt});var WA=wA((Yn,U)=>{var __dirname="/Users/maxim/Projects/Private/Sites/cryptit/node_modules/argon2-browser/dist",i=typeof self!=="undefined"&&typeof self.Module!=="undefined"?self.Module:{},dt=i,d={},w;for(w in i)if(i.hasOwnProperty(w))d[w]=i[w];var p=[],at="./this.program",HA=function(A,t){throw t},IA=!1,T=!1,CA=!1,gt=!1;IA=typeof window==="object";T=typeof importScripts==="function";CA=typeof process==="object"&&typeof process.versions==="object"&&typeof process.versions.node==="string";gt=!IA&&!CA&&!T;var _="";function pt(A){if(i.locateFile)return i.locateFile(A,_);return _+A}var gA,NA,AA,An,UA,GA;if(CA){if(T)_=(OA(),pA(KA)).dirname(_)+"/";else _=__dirname+"/";if(gA=function A(t,n){if(!UA)UA=(()=>({}));if(!GA)GA=(OA(),pA(KA));return t=GA.normalize(t),UA.readFileSync(t,n?null:"utf8")},AA=function A(t){var n=gA(t,!0);if(!n.buffer)n=new Uint8Array(n);return qt(n.buffer),n},process.argv.length>1)at=process.argv[1].replace(/\\/g,"/");if(p=process.argv.slice(2),typeof U!=="undefined")U.exports=i;process.on("uncaughtException",function(A){if(!(A instanceof On))throw A}),process.on("unhandledRejection",jA),HA=function(A){process.exit(A)},i.inspect=function(){return"[Emscripten Module object]"}}else if(gt){if(typeof read!="undefined")gA=function A(t){return read(t)};if(AA=function A(t){var n;if(typeof readbuffer==="function")return new Uint8Array(readbuffer(t));return n=read(t,"binary"),qt(typeof n==="object"),n},typeof scriptArgs!="undefined")p=scriptArgs;else if(typeof arguments!="undefined")p=arguments;if(typeof quit==="function")HA=function(A){quit(A)};if(typeof print!=="undefined"){if(typeof console==="undefined")console={};console.log=print,console.warn=console.error=typeof printErr!=="undefined"?printErr:print}}else if(IA||T){if(T)_=self.location.href;else if(typeof document!=="undefined"&&document.currentScript)_=document.currentScript.src;if(_.indexOf("blob:")!==0)_=_.substr(0,_.lastIndexOf("/")+1);else _="";{if(gA=function(A){var t=new XMLHttpRequest;return t.open("GET",A,!1),t.send(null),t.responseText},T)AA=function(A){var t=new XMLHttpRequest;return t.open("GET",A,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)};NA=function(A,t,n){var r=new XMLHttpRequest;r.open("GET",A,!0),r.responseType="arraybuffer",r.onload=function(){if(r.status==200||r.status==0&&r.response){t(r.response);return}n()},r.onerror=n,r.send(null)}}An=function(A){document.title=A}}var Wn=i.print||console.log.bind(console),M=i.printErr||console.warn.bind(console);for(w in d)if(d.hasOwnProperty(w))i[w]=d[w];d=null;if(i.arguments)p=i.arguments;if(i.thisProgram)at=i.thisProgram;if(i.quit)HA=i.quit;var nA;if(i.wasmBinary)nA=i.wasmBinary;var Jn=i.noExitRuntime||!0;if(typeof WebAssembly!=="object")jA("no native wasm support detected");var rA,lt=!1,tn;function qt(A,t){if(!A)jA("Assertion failed: "+t)}var nn=0,rn=1;function jn(A,t){var n;if(t==rn)n=Kt(A.length);else n=Tt(A.length);if(A.subarray||A.slice)O.set(A,n);else O.set(new Uint8Array(A),n);return n}var ut=typeof TextDecoder!=="undefined"?new TextDecoder("utf8"):void 0;function en(A,t,n){var r=t+n,j=t;while(A[j]&&!(j>=r))++j;if(j-t>16&&A.subarray&&ut)return ut.decode(A.subarray(t,j));else{var e="";while(t<j){var f=A[t++];if(!(f&128)){e+=String.fromCharCode(f);continue}var o=A[t++]&63;if((f&224)==192){e+=String.fromCharCode((f&31)<<6|o);continue}var c=A[t++]&63;if((f&240)==224)f=(f&15)<<12|o<<6|c;else f=(f&7)<<18|o<<12|c<<6|A[t++]&63;if(f<65536)e+=String.fromCharCode(f);else{var u=f-65536;e+=String.fromCharCode(55296|u>>10,56320|u&1023)}}}return e}function fn(A,t){return A?en(O,A,t):""}function on(A,t){if(A%t>0)A+=t-A%t;return A}var DA,_t,O,It,mt,$t,ht,yt,Ft;function Rt(A){DA=A,i.HEAP8=_t=new Int8Array(A),i.HEAP16=It=new Int16Array(A),i.HEAP32=$t=new Int32Array(A),i.HEAPU8=O=new Uint8Array(A),i.HEAPU16=mt=new Uint16Array(A),i.HEAPU32=ht=new Uint32Array(A),i.HEAPF32=yt=new Float32Array(A),i.HEAPF64=Ft=new Float64Array(A)}var Xn=i.INITIAL_MEMORY||16777216,lA,Bt=[],wt=[],Pt=[],sn=!1;function kn(){if(i.preRun){if(typeof i.preRun=="function")i.preRun=[i.preRun];while(i.preRun.length)qn(i.preRun.shift())}VA(Bt)}function cn(){sn=!0,VA(wt)}function vn(){if(i.postRun){if(typeof i.postRun=="function")i.postRun=[i.postRun];while(i.postRun.length)En(i.postRun.shift())}VA(Pt)}function qn(A){Bt.unshift(A)}function un(A){wt.unshift(A)}function En(A){Pt.unshift(A)}var K=0,SA=null,tA=null;function an(A){if(K++,i.monitorRunDependencies)i.monitorRunDependencies(K)}function gn(A){if(K--,i.monitorRunDependencies)i.monitorRunDependencies(K);if(K==0){if(SA!==null)clearInterval(SA),SA=null;if(tA){var t=tA;tA=null,t()}}}i.preloadedImages={};i.preloadedAudios={};function jA(A){if(i.onAbort)i.onAbort(A);A+="",M(A),lt=!0,tn=1,A="abort("+A+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(A);throw t}var ln="data:application/octet-stream;base64,";function Lt(A){return A.startsWith(ln)}function xt(A){return A.startsWith("file://")}var g="argon2.wasm";if(!Lt(g))g=pt(g);function Et(A){try{if(A==g&&nA)return new Uint8Array(nA);if(AA)return AA(A);else throw"both async and sync fetching of the wasm failed"}catch(t){jA(t)}}function _n(){if(!nA&&(IA||T)){if(typeof fetch==="function"&&!xt(g))return fetch(g,{credentials:"same-origin"}).then(function(A){if(!A.ok)throw"failed to load wasm binary file at '"+g+"'";return A.arrayBuffer()}).catch(function(){return Et(g)});else if(NA)return new Promise(function(A,t){NA(g,function(n){A(new Uint8Array(n))},t)})}return Promise.resolve().then(function(){return Et(g)})}function In(){var A={a:yn};function t(f,o){var c=f.exports;i.asm=c,rA=i.asm.c,Rt(rA.buffer),lA=i.asm.k,un(i.asm.d),gn("wasm-instantiate")}an("wasm-instantiate");function n(f){t(f.instance)}function r(f){return _n().then(function(o){var c=WebAssembly.instantiate(o,A);return c}).then(f,function(o){M("failed to asynchronously prepare wasm: "+o),jA(o)})}function j(){if(!nA&&typeof WebAssembly.instantiateStreaming==="function"&&!Lt(g)&&!xt(g)&&typeof fetch==="function")return fetch(g,{credentials:"same-origin"}).then(function(f){var o=WebAssembly.instantiateStreaming(f,A);return o.then(n,function(c){return M("wasm streaming compile failed: "+c),M("falling back to ArrayBuffer instantiation"),r(n)})});else return r(n)}if(i.instantiateWasm)try{var e=i.instantiateWasm(A,t);return e}catch(f){return M("Module.instantiateWasm callback failed with error: "+f),!1}return j(),{}}function VA(A){while(A.length>0){var t=A.shift();if(typeof t=="function"){t(i);continue}var n=t.func;if(typeof n==="number")if(t.arg===void 0)lA.get(n)();else lA.get(n)(t.arg);else n(t.arg===void 0?null:t.arg)}}function mn(A,t,n){O.copyWithin(A,t,t+n)}function $n(A){try{return rA.grow(A-DA.byteLength+65535>>>16),Rt(rA.buffer),1}catch(t){}}function hn(A){var t=O.length;A=A>>>0;var n=2147418112;if(A>n)return!1;for(var r=1;r<=4;r*=2){var j=t*(1+0.2/r);j=Math.min(j,A+100663296);var e=Math.min(n,on(Math.max(A,j),65536)),f=$n(e);if(f)return!0}return!1}var yn={a:mn,b:hn},Fn=In(),Rn=i.___wasm_call_ctors=function(){return(Rn=i.___wasm_call_ctors=i.asm.d).apply(null,arguments)},Bn=i._argon2_hash=function(){return(Bn=i._argon2_hash=i.asm.e).apply(null,arguments)},Tt=i._malloc=function(){return(Tt=i._malloc=i.asm.f).apply(null,arguments)},wn=i._free=function(){return(wn=i._free=i.asm.g).apply(null,arguments)},Pn=i._argon2_verify=function(){return(Pn=i._argon2_verify=i.asm.h).apply(null,arguments)},Ln=i._argon2_error_message=function(){return(Ln=i._argon2_error_message=i.asm.i).apply(null,arguments)},xn=i._argon2_encodedlen=function(){return(xn=i._argon2_encodedlen=i.asm.j).apply(null,arguments)},Tn=i._argon2_hash_ext=function(){return(Tn=i._argon2_hash_ext=i.asm.l).apply(null,arguments)},Kn=i._argon2_verify_ext=function(){return(Kn=i._argon2_verify_ext=i.asm.m).apply(null,arguments)},Kt=i.stackAlloc=function(){return(Kt=i.stackAlloc=i.asm.n).apply(null,arguments)};i.allocate=jn;i.UTF8ToString=fn;i.ALLOC_NORMAL=nn;var _A;function On(A){this.name="ExitStatus",this.message="Program terminated with exit("+A+")",this.status=A}tA=function A(){if(!_A)zA();if(!_A)tA=A};function zA(A){if(A=A||p,K>0)return;if(kn(),K>0)return;function t(){if(_A)return;if(_A=!0,i.calledRun=!0,lt)return;if(cn(),i.onRuntimeInitialized)i.onRuntimeInitialized();vn()}if(i.setStatus)i.setStatus("Running..."),setTimeout(function(){setTimeout(function(){i.setStatus("")},1),t()},1);else t()}i.run=zA;if(i.preInit){if(typeof i.preInit=="function")i.preInit=[i.preInit];while(i.preInit.length>0)i.preInit.pop()()}zA();if(typeof U!=="undefined")U.exports=i;i.unloadRuntime=function(){if(typeof self!=="undefined")delete self.Module;if(i=dt=rA=lA=Fn=DA=_t=O=It=mt=$t=ht=yt=Ft=void 0,typeof U!=="undefined")delete U.exports}});var Ot=wA((Qn,Un)=>{Un.exports="./cryptit.browser.min.wasm"});var Gt=wA((Ut,mA)=>{(function(A,t){if(typeof define==="function"&&define.amd)define([],t);else if(typeof mA==="object"&&mA.exports)mA.exports=t();else A.argon2=t()})(typeof self!=="undefined"?self:Ut,function(){let A=typeof self!=="undefined"?self:this,t={Argon2d:0,Argon2i:1,Argon2id:2};function n(s){if(n._promise)return n._promise;if(n._module)return Promise.resolve(n._module);let v;if(A.process&&A.process.versions&&A.process.versions.node)v=j().then((k)=>new Promise((E)=>{k.postRun=()=>E(k)}));else v=e().then((k)=>{let E=s?o(s):void 0;return r(k,E)});return n._promise=v,v.then((k)=>{return n._module=k,delete n._promise,k})}function r(s,v){return new Promise((k)=>{return A.Module={wasmBinary:s,wasmMemory:v,postRun(){k(Module)}},j()})}function j(){if(A.loadArgon2WasmModule)return A.loadArgon2WasmModule();return Promise.resolve(WA())}function e(){if(A.loadArgon2WasmBinary)return A.loadArgon2WasmBinary();return Promise.resolve(Ot()).then((v)=>{return f(v)})}function f(s){let v=atob(s),k=new Uint8Array(new ArrayBuffer(v.length));for(let E=0;E<v.length;E++)k[E]=v.charCodeAt(E);return k}function o(s){let S=Math.min(Math.max(Math.ceil(s*1024/65536),256)+256,32767);return new WebAssembly.Memory({initial:S,maximum:32767})}function c(s,v){return s.allocate(v,"i8",s.ALLOC_NORMAL)}function u(s,v){let k=new Uint8Array([...v,0]);return c(s,k)}function q(s){if(typeof s!=="string")return s;if(typeof TextEncoder==="function")return new TextEncoder().encode(s);else if(typeof Buffer==="function")return Buffer.from(s);else throw new Error("Don't know how to encode UTF8")}function x(s){let v=s.mem||1024;return n(v).then((k)=>{let E=s.time||1,J=s.parallelism||1,X=q(s.pass),S=u(k,X),FA=X.length,oA=q(s.salt),sA=u(k,oA),Y=oA.length,H=s.type||t.Argon2d,m=k.allocate(new Array(s.hashLen||24),"i8",k.ALLOC_NORMAL),F=s.secret?c(k,s.secret):0,Q=s.secret?s.secret.byteLength:0,l=s.ad?c(k,s.ad):0,zt=s.ad?s.ad.byteLength:0,kA=s.hashLen||24,YA=k._argon2_encodedlen(E,v,J,Y,kA,H),RA=k.allocate(new Array(YA+1),"i8",k.ALLOC_NORMAL),Sn=19,N,cA;try{cA=k._argon2_hash_ext(E,v,J,S,FA,sA,Y,m,kA,RA,YA,H,F,Q,l,zt,19)}catch(C){N=C}let vA;if(cA===0&&!N){let C="",QA=new Uint8Array(kA);for(let qA=0;qA<kA;qA++){let ZA=k.HEAP8[m+qA];QA[qA]=ZA,C+=("0"+(255&ZA).toString(16)).slice(-2)}let Wt=k.UTF8ToString(RA);vA={hash:QA,hashHex:C,encoded:Wt}}else{try{if(!N)N=k.UTF8ToString(k._argon2_error_message(cA))}catch(C){}vA={message:N,code:cA}}try{if(k._free(S),k._free(sA),k._free(m),k._free(RA),l)k._free(l);if(F)k._free(F)}catch(C){}if(N)throw vA;else return vA})}function W(s){return n().then((v)=>{let k=q(s.pass),E=u(v,k),J=k.length,X=s.secret?c(v,s.secret):0,S=s.secret?s.secret.byteLength:0,FA=s.ad?c(v,s.ad):0,oA=s.ad?s.ad.byteLength:0,sA=q(s.encoded),Y=u(v,sA),H=s.type;if(H===void 0){let l=s.encoded.split("$")[1];if(l)l=l.replace("a","A"),H=t[l]||t.Argon2d}let m,F;try{F=v._argon2_verify_ext(Y,E,J,X,S,FA,oA,H)}catch(l){m=l}let Q;if(F||m){try{if(!m)m=v.UTF8ToString(v._argon2_error_message(F))}catch(l){}Q={message:m,code:F}}try{v._free(E),v._free(Y)}catch(l){}if(m)throw Q;else return Q})}function y(){if(n._module)n._module.unloadRuntime(),delete n._promise,delete n._module}return{ArgonType:t,hash:x,verify:W,unloadRuntime:y}})});class h extends Error{constructor(A){super(A);Object.setPrototypeOf(this,new.target.prototype),this.name=new.target.name,this.stack=void 0}}class R extends h{}class b extends h{}class LA extends h{}class uA extends h{}class D extends h{}class B extends h{}class EA extends h{}class I extends h{}class a{static byId=new Map;static register(A){if(this.byId.has(A.id))throw new uA(`Version ${A.id} already registered`);this.byId.set(A.id,A)}static get(A){let t=this.byId.get(A);if(!t)throw new uA(`Unknown version: ${A}`);return t}static get current(){return this.get(0)}}class xA{p;key;constructor(A){this.p=A}setKey(A){this.key=A}async encryptChunk(A){let t=this.p.getRandomValues(new Uint8Array(12)),n=new Uint8Array(await this.p.subtle.encrypt({name:"AES-GCM",iv:t},this.key,A)),r=new Uint8Array(t.length+n.length);return r.set(t),r.set(n,t.length),r}async decryptChunk(A){let t=A.slice(0,12),n=A.slice(12),r=await this.p.subtle.decrypt({name:"AES-GCM",iv:t},this.key,n);try{let j=await this.p.subtle.decrypt({name:"AES-GCM",iv:t},this.key,n);return new Uint8Array(j)}catch{throw new I("Decryption failed: wrong passphrase or corrupted ciphertext")}}}var $A=BA(Gt(),1);async function St(A,t,n,r){if(r==="node"){let j=await import("argon2"),e=typeof A==="string"?Buffer.from(A,"utf8"):Buffer.from(A),f=Buffer.from(t),o=await j.hash(e,{salt:f,timeCost:n.time,memoryCost:n.mem,parallelism:n.parallelism,hashLength:32,raw:!0,type:j.argon2id});return{hash:new Uint8Array(o)}}if(r==="browser"){if(!("loadArgon2WasmBinary"in globalThis))globalThis.loadArgon2WasmBinary=()=>{let j=new URL("argon2.wasm",import.meta.url).href;return fetch(j).then((e)=>{if(!e.ok)throw new Error("Failed to load argon2.wasm");return e.arrayBuffer()}).then((e)=>new Uint8Array(e))};return $A.hash({pass:A,salt:t,time:n.time,mem:n.mem,parallelism:n.parallelism,hashLen:32,type:$A.ArgonType.Argon2id}).then((j)=>{if(!j||!j.hash)throw new Error("Failed to produce key derivation");return{hash:j.hash}}).catch((j)=>{let e=j instanceof Error?j.message:typeof j==="string"?j:"Unknown error";throw new B(`argon2-browser failure: ${e}`)})}throw new Error(`Unsupported environment: ${r}`)}class JA{presets;name="argon2id";constructor(A){this.presets=A}async derive(A,t,n,r){let{hash:j}=await St(A,t,this.presets[n],r.isNode?"node":"browser");return r.subtle.importKey("raw",j,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}}var Ht={low:{time:5,mem:65536,parallelism:1},middle:{time:20,mem:65536,parallelism:1},high:{time:40,mem:65536,parallelism:1}},Gn={id:0,cipher:xA,kdf:new JA(Ht),saltLengths:{low:12,high:16},difficulties:Ht,defaultChunkSize:524288};a.register(Gn);var hA=1;function Nt(){return typeof process!=="undefined"&&typeof process.versions==="object"&&!1}function eA(...A){let t=A.reduce((j,e)=>j+e.byteLength,0),n=new Uint8Array(t),r=0;for(let j of A)n.set(j,r),r+=j.byteLength;return n}function iA(...A){try{let t=eA(...A);if(Nt())return Buffer.from(t).toString("base64");let n="";for(let r=0;r<t.length;r++)n+=String.fromCharCode(t[r]);return btoa(n)}catch(t){throw new LA("Base64 Enconding Error")}}function XA(A){try{if(!/^[A-Za-z0-9+/]+={0,2}$/.test(A)||A.length%4!==0)throw new Error("invalid base64");if(Nt())return new Uint8Array(Buffer.from(A,"base64"));let t=atob(A),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}catch(t){throw new b("Base64 Decoding Error")}}function yA(A,t,n,r){let j={low:0,middle:1,high:2}[t]??0,e=A<<5|(n==="high"?1:0)<<2|j;return eA(new Uint8Array([hA,e]),r)}function G(A){if(A[0]!==hA)throw new R("Invalid input format. The input is unknown.");try{let t=A[1],n=t>>5,r=t>>2&1?"high":"low",j=t&3,e=["low","middle","high"][j],f=a.get(n).saltLengths[r],o=A.slice(2,2+f);return{version:n,difficulty:e,saltStrength:r,salt:o,headerLen:2+f}}catch(t){throw new D(t instanceof Error?t.message:String(t))}}class fA{engine;chunkSize;buffer=new Uint8Array(0);constructor(A,t=524288){this.engine=A;this.chunkSize=t}toTransformStream(){return new TransformStream({transform:async(A,t)=>{await this.transform(await this.asUint8Array(A),t)},flush:async(A)=>this.flush(A)})}async transform(A,t){let n=new Uint8Array(this.buffer.length+A.length);n.set(this.buffer),n.set(A,this.buffer.length);let r=0;while(n.length-r>=this.chunkSize){let j=n.slice(r,r+this.chunkSize);r+=this.chunkSize;let e=await this.engine.encryptChunk(j),f=new Uint8Array(4);new DataView(f.buffer).setUint32(0,e.length,!1);let o=new Uint8Array(4+e.length);o.set(f),o.set(e,f.length),t.enqueue(o)}this.buffer=n.slice(r)}async flush(A){if(!this.buffer.length)return;let t=await this.engine.encryptChunk(this.buffer),n=new Uint8Array(4);new DataView(n.buffer).setUint32(0,t.length,!1);let r=new Uint8Array(4+t.length);r.set(n),r.set(t,4),A.enqueue(r),this.buffer=new Uint8Array(0)}async asUint8Array(A){if(A instanceof Uint8Array)return A;if(A instanceof ArrayBuffer)return new Uint8Array(A);return new Uint8Array(await A.arrayBuffer())}}class V{engine;chunkSize;buffer=new Uint8Array(0);constructor(A,t=524288){this.engine=A;this.chunkSize=t}toTransformStream(){return new TransformStream({transform:async(A,t)=>{await this.transform(await this.asUint8Array(A),t)},flush:async(A)=>this.flush(A)})}async transform(A,t){let n=new Uint8Array(this.buffer.length+A.length);n.set(this.buffer),n.set(A,this.buffer.length);let r=0;while(!0){if(n.length-r<4)break;let j=new DataView(n.buffer,n.byteOffset+r,4).getUint32(0,!1);if(n.length-r-4<j)break;r+=4;let e=n.slice(r,r+j);r+=j;try{let f=await this.engine.decryptChunk(e);t.enqueue(f)}catch(f){throw f instanceof I?f:new I("Decryption failed: Wrong passphrase or corrupted ciphertext")}}this.buffer=n.slice(r)}async flush(A){await this.transform(new Uint8Array(0),A),this.buffer=new Uint8Array(0)}async asUint8Array(A){if(A instanceof Uint8Array)return A;if(A instanceof ArrayBuffer)return new Uint8Array(A);return new Uint8Array(await A.arrayBuffer())}}class z{engine;chunkSize;constructor(A,t=524288){this.engine=A;this.chunkSize=t}encryptionStream(){let A=new fA(this.engine,this.chunkSize).toTransformStream();return{writable:A.writable,readable:A.readable}}decryptionStream(A){let t=A,n=new TransformStream({transform(j,e){if(t===0){e.enqueue(j);return}if(j.byteLength<=t){t-=j.byteLength;return}e.enqueue(j.slice(t)),t=0}}),r=new V(this.engine,this.chunkSize).toTransformStream();return{writable:n.writable,readable:n.readable.pipeThrough(r)}}async collect(A,t,n=null){let r=A.pipeThrough(t).getReader(),j=[];if(n?.length)j.push(n);while(!0){let{value:c,done:u}=await r.read();if(u)break;j.push(c)}let e=j.reduce((c,u)=>c+u.byteLength,0),f=new Uint8Array(e),o=0;for(let c of j)f.set(c,o),o+=c.byteLength;return f}}function Ct(A=0,t=console.info){return{level:A,log(n,r){if(n<=A)t(`${n}| ${r}`)}}}var Dt=new Map;class P{static getEngine(A,t){let n=Dt.get(t);if(n)return n;let r=a.get(t),j=new r.cipher(A),e=r.kdf,f=r.defaultChunkSize;return n={desc:r,cipher:j,kdf:e,chunkSize:f,provider:A},Dt.set(t,n),n}static async deriveKey(A,t,n,r){try{let j=await A.kdf.derive(t,n,r,A.provider);A.cipher.key=j}catch(j){let e=j instanceof Error?j.message:String(j);throw new B(e)}}}class L{provider;v;cipher;kdf;chunkSize;stream;difficulty;saltStrength;engines=new Map;log;constructor(A,t={}){this.provider=A;this.v=a.get(t.version??a.current.id),this.cipher=new this.v.cipher(A),this.kdf=this.v.kdf,this.chunkSize=t.chunkSize??this.v.defaultChunkSize,this.stream=new z(this.cipher,this.chunkSize),this.difficulty=t.difficulty??"middle",this.saltStrength=t.saltStrength??"high",this.log=Ct(t.verbose??0,t.logger)}static async isEncrypted(A){try{return await L.peekHeader(A),!0}catch{return!1}}static async headerDecode(A){let t=await L.peekHeader(A),n=G(t);return{version:n.version,difficulty:n.difficulty,salt:iA(n.salt),saltLength:n.salt.byteLength}}setDifficulty(A){this.difficulty=A}getDifficulty(){return this.difficulty}setVersion(A){this.v=a.get(A),this.cipher=new this.v.cipher(this.provider),this.kdf=this.v.kdf,this.stream=new z(this.cipher,this.chunkSize)}getVersion(){return this.v.id}setSaltDifficulty(A){this.saltStrength=A}getSaltDifficulty(){return this.saltStrength}setChunkSize(A){this.chunkSize=A,this.stream=new z(this.cipher,this.chunkSize)}getChunkSize(){return this.chunkSize}setVerbose(A){this.log.level=A}getVerbose(){return this.log.level}async encryptText(A,t){try{this.log.log(1,"Start text encryption"),this.log.log(2,"Deriving key for text encryption");let n=this.genSalt();await this.deriveKey(t,n),this.log.log(3,`Salt generated: ${iA(n)}, KDF difficulty: ${this.difficulty}`),this.log.log(2,"Encrypting text data");let r=await this.cipher.encryptChunk(typeof A==="string"?new TextEncoder().encode(A):A);this.log.log(3,"Encoding header");let j=yA(this.v.id,this.difficulty,this.saltStrength,n);this.log.log(3,"Encoding text");let e=iA(j,r);return this.log.log(1,"Decryption finished"),e}catch(n){throw new EA(n instanceof Error?n.message:String(n))}}async decryptText(A,t){try{this.log.log(1,"Start text decryption"),this.log.log(3,"Start text decoding");let n=XA(A);this.log.log(3,"Start header decoding"),await L.peekHeader(A);let r=G(n);this.log.log(3,"Trying to get engine");let j=P.getEngine(this.provider,r.version);this.log.log(2,"Deriving key via engine for text decryption"),this.log.log(3,`Salt use: ${iA(r.salt)}, KDF difficulty: ${r.difficulty}`),await P.deriveKey(j,t,r.salt,r.difficulty),this.log.log(2,"Decrypting text data");let e=await j.cipher.decryptChunk(n.slice(r.headerLen));this.log.log(3,"Decoding text");let f=new TextDecoder().decode(e);return this.log.log(1,"Decryption finished"),f}catch(n){if(n instanceof I||n instanceof R||n instanceof D||n instanceof b||n instanceof B)throw n;throw new I("Decryption failed: wrong passphrase or corrupted ciphertext")}}async encryptFile(A,t){try{this.log.log(2,"Deriving key for file encryption");let n=this.genSalt();await this.deriveKey(t,n);let r=yA(this.v.id,this.difficulty,this.saltStrength,n),j=await this.stream.collect(A.stream(),new fA(this.cipher,this.chunkSize).toTransformStream(),r);return new Blob([j],{type:"application/octet-stream"})}catch(n){throw new EA(n instanceof Error?n.message:String(n))}}async decryptFile(A,t){try{let n=await L.peekHeader(A),r=G(n),j=P.getEngine(this.provider,r.version);await P.deriveKey(j,t,r.salt,r.difficulty),this.log.log(2,"Decrypting file data");let f=await new z(j.cipher,j.chunkSize).collect(A.slice(r.headerLen).stream(),new V(j.cipher,j.chunkSize).toTransformStream());return new Blob([f],{type:"application/octet-stream"})}catch(n){if(n instanceof I)throw n;throw new I(n instanceof Error?n.message:String(n))}}async createEncryptionStream(A){this.log.log(2,"Deriving key for stream encryption");let t=this.genSalt();await this.deriveKey(A,t);let n=yA(this.v.id,this.difficulty,this.saltStrength,t),r=this.stream.encryptionStream();return{header:n,writable:r.writable,readable:r.readable}}async createDecryptionStream(A){let t=this,n=new Uint8Array(0),r=null;async function j(e,f){let o=e.getReader();while(!0){let{value:c,done:u}=await o.read();if(u)break;f.enqueue(c)}}return new TransformStream({async transform(e,f){if(!r){if(n=eA(n,e),n.length<2)return;let c=n.slice(0,30),{salt:u,difficulty:q}=G(c),x=n[1]>>5,W=n[1]>>2&1?"high":"low",s=2+a.get(x).saltLengths[W];if(n.length<s)return;let v=P.getEngine(t.provider,x);await P.deriveKey(v,A,u,q),r=new V(v.cipher,v.chunkSize).toTransformStream(),j(r.readable,f);let k=n.slice(s);if(k.length){let E=r.writable.getWriter();await E.write(k),E.releaseLock()}return}let o=r.writable.getWriter();await o.write(e),o.releaseLock()},async flush(){if(r){let e=r.writable.getWriter();await e.close(),e.releaseLock()}}})}async deriveKey(A,t,n=this.difficulty){let r=performance.now();try{let j=await this.kdf.derive(A,t,n,this.provider);this.cipher.key=j,this.log.log(3,`Key derivation completed in ${(performance.now()-r).toFixed(1)} ms`)}catch(j){throw new B(j instanceof Error?j.message:String(j))}}genSalt(){let A=this.v.saltLengths[this.saltStrength];return this.provider.getRandomValues(new Uint8Array(A))}static async peekHeader(A){if(typeof A==="string")A=XA(A);if(A instanceof Uint8Array){if(A.length<2)throw new R("Input too short");let{headerLen:t}=G(A.length>=16?A:Uint8Array.from(A));if(A.length<t)throw new R("Incomplete header");return A.slice(0,t)}if(A instanceof Blob){let t=new Uint8Array(await A.slice(0,2).arrayBuffer());if(t[0]!==1)throw new R("Invalid input format. The input is unknown.");let n=t[1],r=n>>5,j=n>>2&1?"high":"low",e=a.get(r).saltLengths[j],f=new Uint8Array(await A.slice(0,2+e).arrayBuffer());return G(f),f}throw new D("Unsupported input type")}}var Vt={subtle:globalThis.crypto.subtle,getRandomValues(A){return globalThis.crypto.getRandomValues(A)},isNode:!1};function Nr(A){return new L(Vt,A)}export{Nr as createCryptit,L as Cryptit};

//# debugId=248F5AC0FD0679BC64756E2164756E21

#!/usr/bin/env node
import{createRequire as B$}from"node:module";var V$=Object.create;var{getPrototypeOf:R$,defineProperty:BU,getOwnPropertyNames:P$}=Object;var N$=Object.prototype.hasOwnProperty;var x0=(U,$,J)=>{J=U!=null?V$(R$(U)):{};let Q=$||!U||!U.__esModule?BU(J,"default",{value:U,enumerable:!0}):J;for(let Z of P$(U))if(!N$.call(Q,Z))BU(Q,Z,{get:()=>U[Z],enumerable:!0});return Q};var P0=(U,$)=>()=>($||U(($={exports:{}}).exports,$),$.exports);var K0=B$(import.meta.url);var A0=P0((H$)=>{class o0 extends Error{constructor(U,$,J){super(J);Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.code=$,this.exitCode=U,this.nestedError=void 0}}class HU extends o0{constructor(U){super(1,"commander.invalidArgument",U);Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name}}H$.CommanderError=o0;H$.InvalidArgumentError=HU});var g0=P0((j$)=>{var{InvalidArgumentError:F$}=A0();class IU{constructor(U,$){switch(this.description=$||"",this.variadic=!1,this.parseArg=void 0,this.defaultValue=void 0,this.defaultValueDescription=void 0,this.argChoices=void 0,U[0]){case"<":this.required=!0,this._name=U.slice(1,-1);break;case"[":this.required=!1,this._name=U.slice(1,-1);break;default:this.required=!0,this._name=U;break}if(this._name.length>3&&this._name.slice(-3)==="...")this.variadic=!0,this._name=this._name.slice(0,-3)}name(){return this._name}_concatValue(U,$){if($===this.defaultValue||!Array.isArray($))return[U];return $.concat(U)}default(U,$){return this.defaultValue=U,this.defaultValueDescription=$,this}argParser(U){return this.parseArg=U,this}choices(U){return this.argChoices=U.slice(),this.parseArg=($,J)=>{if(!this.argChoices.includes($))throw new F$(`Allowed choices are ${this.argChoices.join(", ")}.`);if(this.variadic)return this._concatValue($,J);return $},this}argRequired(){return this.required=!0,this}argOptional(){return this.required=!1,this}}function S$(U){let $=U.name()+(U.variadic===!0?"...":"");return U.required?"<"+$+">":"["+$+"]"}j$.Argument=IU;j$.humanReadableArgName=S$});var a0=P0((w$)=>{var{humanReadableArgName:L$}=g0();class MU{constructor(){this.helpWidth=void 0,this.sortSubcommands=!1,this.sortOptions=!1,this.showGlobalOptions=!1}visibleCommands(U){let $=U.commands.filter((J)=>!J._hidden);if(U._hasImplicitHelpCommand()){let[,J,Q]=U._helpCommandnameAndArgs.match(/([^ ]+) *(.*)/),Z=U.createCommand(J).helpOption(!1);if(Z.description(U._helpCommandDescription),Q)Z.arguments(Q);$.push(Z)}if(this.sortSubcommands)$.sort((J,Q)=>{return J.name().localeCompare(Q.name())});return $}compareOptions(U,$){let J=(Q)=>{return Q.short?Q.short.replace(/^-/,""):Q.long.replace(/^--/,"")};return J(U).localeCompare(J($))}visibleOptions(U){let $=U.options.filter((Z)=>!Z.hidden),J=U._hasHelpOption&&U._helpShortFlag&&!U._findOption(U._helpShortFlag),Q=U._hasHelpOption&&!U._findOption(U._helpLongFlag);if(J||Q){let Z;if(!J)Z=U.createOption(U._helpLongFlag,U._helpDescription);else if(!Q)Z=U.createOption(U._helpShortFlag,U._helpDescription);else Z=U.createOption(U._helpFlags,U._helpDescription);$.push(Z)}if(this.sortOptions)$.sort(this.compareOptions);return $}visibleGlobalOptions(U){if(!this.showGlobalOptions)return[];let $=[];for(let J=U.parent;J;J=J.parent){let Q=J.options.filter((Z)=>!Z.hidden);$.push(...Q)}if(this.sortOptions)$.sort(this.compareOptions);return $}visibleArguments(U){if(U._argsDescription)U.registeredArguments.forEach(($)=>{$.description=$.description||U._argsDescription[$.name()]||""});if(U.registeredArguments.find(($)=>$.description))return U.registeredArguments;return[]}subcommandTerm(U){let $=U.registeredArguments.map((J)=>L$(J)).join(" ");return U._name+(U._aliases[0]?"|"+U._aliases[0]:"")+(U.options.length?" [options]":"")+($?" "+$:"")}optionTerm(U){return U.flags}argumentTerm(U){return U.name()}longestSubcommandTermLength(U,$){return $.visibleCommands(U).reduce((J,Q)=>{return Math.max(J,$.subcommandTerm(Q).length)},0)}longestOptionTermLength(U,$){return $.visibleOptions(U).reduce((J,Q)=>{return Math.max(J,$.optionTerm(Q).length)},0)}longestGlobalOptionTermLength(U,$){return $.visibleGlobalOptions(U).reduce((J,Q)=>{return Math.max(J,$.optionTerm(Q).length)},0)}longestArgumentTermLength(U,$){return $.visibleArguments(U).reduce((J,Q)=>{return Math.max(J,$.argumentTerm(Q).length)},0)}commandUsage(U){let $=U._name;if(U._aliases[0])$=$+"|"+U._aliases[0];let J="";for(let Q=U.parent;Q;Q=Q.parent)J=Q.name()+" "+J;return J+$+" "+U.usage()}commandDescription(U){return U.description()}subcommandDescription(U){return U.summary()||U.description()}optionDescription(U){let $=[];if(U.argChoices)$.push(`choices: ${U.argChoices.map((J)=>JSON.stringify(J)).join(", ")}`);if(U.defaultValue!==void 0){if(U.required||U.optional||U.isBoolean()&&typeof U.defaultValue==="boolean")$.push(`default: ${U.defaultValueDescription||JSON.stringify(U.defaultValue)}`)}if(U.presetArg!==void 0&&U.optional)$.push(`preset: ${JSON.stringify(U.presetArg)}`);if(U.envVar!==void 0)$.push(`env: ${U.envVar}`);if($.length>0)return`${U.description} (${$.join(", ")})`;return U.description}argumentDescription(U){let $=[];if(U.argChoices)$.push(`choices: ${U.argChoices.map((J)=>JSON.stringify(J)).join(", ")}`);if(U.defaultValue!==void 0)$.push(`default: ${U.defaultValueDescription||JSON.stringify(U.defaultValue)}`);if($.length>0){let J=`(${$.join(", ")})`;if(U.description)return`${U.description} ${J}`;return J}return U.description}formatHelp(U,$){let J=$.padWidth(U,$),Q=$.helpWidth||80,Z=2,q=2;function Y(T,V){if(V){let N=`${T.padEnd(J+2)}${V}`;return $.wrap(N,Q-2,J+2)}return T}function X(T){return T.join(`
`).replace(/^/gm," ".repeat(2))}let G=[`Usage: ${$.commandUsage(U)}`,""],W=$.commandDescription(U);if(W.length>0)G=G.concat([$.wrap(W,Q,0),""]);let z=$.visibleArguments(U).map((T)=>{return Y($.argumentTerm(T),$.argumentDescription(T))});if(z.length>0)G=G.concat(["Arguments:",X(z),""]);let K=$.visibleOptions(U).map((T)=>{return Y($.optionTerm(T),$.optionDescription(T))});if(K.length>0)G=G.concat(["Options:",X(K),""]);if(this.showGlobalOptions){let T=$.visibleGlobalOptions(U).map((V)=>{return Y($.optionTerm(V),$.optionDescription(V))});if(T.length>0)G=G.concat(["Global Options:",X(T),""])}let R=$.visibleCommands(U).map((T)=>{return Y($.subcommandTerm(T),$.subcommandDescription(T))});if(R.length>0)G=G.concat(["Commands:",X(R),""]);return G.join(`
`)}padWidth(U,$){return Math.max($.longestOptionTermLength(U,$),$.longestGlobalOptionTermLength(U,$),$.longestSubcommandTermLength(U,$),$.longestArgumentTermLength(U,$))}wrap(U,$,J,Q=40){let q=new RegExp(`[\\n][${" \\f\\t\\v   -   　\uFEFF"}]+`);if(U.match(q))return U;let Y=$-J;if(Y<Q)return U;let X=U.slice(0,J),G=U.slice(J).replace(`\r
`,`
`),W=" ".repeat(J),K=`\\s${"​"}`,R=new RegExp(`
|.{1,${Y-1}}([${K}]|$)|[^${K}]+?([${K}]|$)`,"g"),T=G.match(R)||[];return X+T.map((V,N)=>{if(V===`
`)return"";return(N>0?W:"")+V.trimEnd()}).join(`
`)}}w$.Help=MU});var t0=P0((C$)=>{var{InvalidArgumentError:E$}=A0();class FU{constructor(U,$){this.flags=U,this.description=$||"",this.required=U.includes("<"),this.optional=U.includes("["),this.variadic=/\w\.\.\.[>\]]$/.test(U),this.mandatory=!1;let J=jU(U);if(this.short=J.shortFlag,this.long=J.longFlag,this.negate=!1,this.long)this.negate=this.long.startsWith("--no-");this.defaultValue=void 0,this.defaultValueDescription=void 0,this.presetArg=void 0,this.envVar=void 0,this.parseArg=void 0,this.hidden=!1,this.argChoices=void 0,this.conflictsWith=[],this.implied=void 0}default(U,$){return this.defaultValue=U,this.defaultValueDescription=$,this}preset(U){return this.presetArg=U,this}conflicts(U){return this.conflictsWith=this.conflictsWith.concat(U),this}implies(U){let $=U;if(typeof U==="string")$={[U]:!0};return this.implied=Object.assign(this.implied||{},$),this}env(U){return this.envVar=U,this}argParser(U){return this.parseArg=U,this}makeOptionMandatory(U=!0){return this.mandatory=!!U,this}hideHelp(U=!0){return this.hidden=!!U,this}_concatValue(U,$){if($===this.defaultValue||!Array.isArray($))return[U];return $.concat(U)}choices(U){return this.argChoices=U.slice(),this.parseArg=($,J)=>{if(!this.argChoices.includes($))throw new E$(`Allowed choices are ${this.argChoices.join(", ")}.`);if(this.variadic)return this._concatValue($,J);return $},this}name(){if(this.long)return this.long.replace(/^--/,"");return this.short.replace(/^-/,"")}attributeName(){return O$(this.name().replace(/^no-/,""))}is(U){return this.short===U||this.long===U}isBoolean(){return!this.required&&!this.optional&&!this.negate}}class SU{constructor(U){this.positiveOptions=new Map,this.negativeOptions=new Map,this.dualOptions=new Set,U.forEach(($)=>{if($.negate)this.negativeOptions.set($.attributeName(),$);else this.positiveOptions.set($.attributeName(),$)}),this.negativeOptions.forEach(($,J)=>{if(this.positiveOptions.has(J))this.dualOptions.add(J)})}valueFromOption(U,$){let J=$.attributeName();if(!this.dualOptions.has(J))return!0;let Q=this.negativeOptions.get(J).presetArg,Z=Q!==void 0?Q:!1;return $.negate===(Z===U)}}function O$(U){return U.split("-").reduce(($,J)=>{return $+J[0].toUpperCase()+J.slice(1)})}function jU(U){let $,J,Q=U.split(/[ |,]+/);if(Q.length>1&&!/^[[<]/.test(Q[1]))$=Q.shift();if(J=Q.shift(),!$&&/^-[^-]$/.test(J))$=J,J=void 0;return{shortFlag:$,longFlag:J}}C$.Option=FU;C$.splitOptionFlags=jU;C$.DualOptions=SU});var DU=P0((x$)=>{function b$(U,$){if(Math.abs(U.length-$.length)>3)return Math.max(U.length,$.length);let J=[];for(let Q=0;Q<=U.length;Q++)J[Q]=[Q];for(let Q=0;Q<=$.length;Q++)J[0][Q]=Q;for(let Q=1;Q<=$.length;Q++)for(let Z=1;Z<=U.length;Z++){let q=1;if(U[Z-1]===$[Q-1])q=0;else q=1;if(J[Z][Q]=Math.min(J[Z-1][Q]+1,J[Z][Q-1]+1,J[Z-1][Q-1]+q),Z>1&&Q>1&&U[Z-1]===$[Q-2]&&U[Z-2]===$[Q-1])J[Z][Q]=Math.min(J[Z][Q],J[Z-2][Q-2]+1)}return J[U.length][$.length]}function f$(U,$){if(!$||$.length===0)return"";$=Array.from(new Set($));let J=U.startsWith("--");if(J)U=U.slice(2),$=$.map((Y)=>Y.slice(2));let Q=[],Z=3,q=0.4;if($.forEach((Y)=>{if(Y.length<=1)return;let X=b$(U,Y),G=Math.max(U.length,Y.length);if((G-X)/G>q){if(X<Z)Z=X,Q=[Y];else if(X===Z)Q.push(Y)}}),Q.sort((Y,X)=>Y.localeCompare(X)),J)Q=Q.map((Y)=>`--${Y}`);if(Q.length>1)return`
(Did you mean one of ${Q.join(", ")}?)`;if(Q.length===1)return`
(Did you mean ${Q[0]}?)`;return""}x$.suggestSimilar=f$});var EU=P0((p$)=>{var h$=K0("events").EventEmitter,e0=K0("child_process"),J0=K0("path"),UU=K0("fs"),k=K0("process"),{Argument:m$,humanReadableArgName:u$}=g0(),{CommanderError:$U}=A0(),{Help:l$}=a0(),{Option:_U,splitOptionFlags:c$,DualOptions:d$}=t0(),{suggestSimilar:LU}=DU();class JU extends h${constructor(U){super();this.commands=[],this.options=[],this.parent=null,this._allowUnknownOption=!1,this._allowExcessArguments=!0,this.registeredArguments=[],this._args=this.registeredArguments,this.args=[],this.rawArgs=[],this.processedArgs=[],this._scriptPath=null,this._name=U||"",this._optionValues={},this._optionValueSources={},this._storeOptionsAsProperties=!1,this._actionHandler=null,this._executableHandler=!1,this._executableFile=null,this._executableDir=null,this._defaultCommandName=null,this._exitCallback=null,this._aliases=[],this._combineFlagAndOptionalValue=!0,this._description="",this._summary="",this._argsDescription=void 0,this._enablePositionalOptions=!1,this._passThroughOptions=!1,this._lifeCycleHooks={},this._showHelpAfterError=!1,this._showSuggestionAfterError=!0,this._outputConfiguration={writeOut:($)=>k.stdout.write($),writeErr:($)=>k.stderr.write($),getOutHelpWidth:()=>k.stdout.isTTY?k.stdout.columns:void 0,getErrHelpWidth:()=>k.stderr.isTTY?k.stderr.columns:void 0,outputError:($,J)=>J($)},this._hidden=!1,this._hasHelpOption=!0,this._helpFlags="-h, --help",this._helpDescription="display help for command",this._helpShortFlag="-h",this._helpLongFlag="--help",this._addImplicitHelpCommand=void 0,this._helpCommandName="help",this._helpCommandnameAndArgs="help [command]",this._helpCommandDescription="display help for command",this._helpConfiguration={}}copyInheritedSettings(U){return this._outputConfiguration=U._outputConfiguration,this._hasHelpOption=U._hasHelpOption,this._helpFlags=U._helpFlags,this._helpDescription=U._helpDescription,this._helpShortFlag=U._helpShortFlag,this._helpLongFlag=U._helpLongFlag,this._helpCommandName=U._helpCommandName,this._helpCommandnameAndArgs=U._helpCommandnameAndArgs,this._helpCommandDescription=U._helpCommandDescription,this._helpConfiguration=U._helpConfiguration,this._exitCallback=U._exitCallback,this._storeOptionsAsProperties=U._storeOptionsAsProperties,this._combineFlagAndOptionalValue=U._combineFlagAndOptionalValue,this._allowExcessArguments=U._allowExcessArguments,this._enablePositionalOptions=U._enablePositionalOptions,this._showHelpAfterError=U._showHelpAfterError,this._showSuggestionAfterError=U._showSuggestionAfterError,this}_getCommandAndAncestors(){let U=[];for(let $=this;$;$=$.parent)U.push($);return U}command(U,$,J){let Q=$,Z=J;if(typeof Q==="object"&&Q!==null)Z=Q,Q=null;Z=Z||{};let[,q,Y]=U.match(/([^ ]+) *(.*)/),X=this.createCommand(q);if(Q)X.description(Q),X._executableHandler=!0;if(Z.isDefault)this._defaultCommandName=X._name;if(X._hidden=!!(Z.noHelp||Z.hidden),X._executableFile=Z.executableFile||null,Y)X.arguments(Y);if(this.commands.push(X),X.parent=this,X.copyInheritedSettings(this),Q)return this;return X}createCommand(U){return new JU(U)}createHelp(){return Object.assign(new l$,this.configureHelp())}configureHelp(U){if(U===void 0)return this._helpConfiguration;return this._helpConfiguration=U,this}configureOutput(U){if(U===void 0)return this._outputConfiguration;return Object.assign(this._outputConfiguration,U),this}showHelpAfterError(U=!0){if(typeof U!=="string")U=!!U;return this._showHelpAfterError=U,this}showSuggestionAfterError(U=!0){return this._showSuggestionAfterError=!!U,this}addCommand(U,$){if(!U._name)throw new Error(`Command passed to .addCommand() must have a name
- specify the name in Command constructor or using .name()`);if($=$||{},$.isDefault)this._defaultCommandName=U._name;if($.noHelp||$.hidden)U._hidden=!0;return this.commands.push(U),U.parent=this,this}createArgument(U,$){return new m$(U,$)}argument(U,$,J,Q){let Z=this.createArgument(U,$);if(typeof J==="function")Z.default(Q).argParser(J);else Z.default(J);return this.addArgument(Z),this}arguments(U){return U.trim().split(/ +/).forEach(($)=>{this.argument($)}),this}addArgument(U){let $=this.registeredArguments.slice(-1)[0];if($&&$.variadic)throw new Error(`only the last argument can be variadic '${$.name()}'`);if(U.required&&U.defaultValue!==void 0&&U.parseArg===void 0)throw new Error(`a default value for a required argument is never used: '${U.name()}'`);return this.registeredArguments.push(U),this}addHelpCommand(U,$){if(U===!1)this._addImplicitHelpCommand=!1;else{if(this._addImplicitHelpCommand=!0,typeof U==="string")this._helpCommandName=U.split(" ")[0],this._helpCommandnameAndArgs=U;this._helpCommandDescription=$||this._helpCommandDescription}return this}_hasImplicitHelpCommand(){if(this._addImplicitHelpCommand===void 0)return this.commands.length&&!this._actionHandler&&!this._findCommand("help");return this._addImplicitHelpCommand}hook(U,$){let J=["preSubcommand","preAction","postAction"];if(!J.includes(U))throw new Error(`Unexpected value for event passed to hook : '${U}'.
Expecting one of '${J.join("', '")}'`);if(this._lifeCycleHooks[U])this._lifeCycleHooks[U].push($);else this._lifeCycleHooks[U]=[$];return this}exitOverride(U){if(U)this._exitCallback=U;else this._exitCallback=($)=>{if($.code!=="commander.executeSubCommandAsync")throw $};return this}_exit(U,$,J){if(this._exitCallback)this._exitCallback(new $U(U,$,J));k.exit(U)}action(U){let $=(J)=>{let Q=this.registeredArguments.length,Z=J.slice(0,Q);if(this._storeOptionsAsProperties)Z[Q]=this;else Z[Q]=this.opts();return Z.push(this),U.apply(this,Z)};return this._actionHandler=$,this}createOption(U,$){return new _U(U,$)}_callParseArg(U,$,J,Q){try{return U.parseArg($,J)}catch(Z){if(Z.code==="commander.invalidArgument"){let q=`${Q} ${Z.message}`;this.error(q,{exitCode:Z.exitCode,code:Z.code})}throw Z}}addOption(U){let $=U.name(),J=U.attributeName();if(U.negate){let Z=U.long.replace(/^--no-/,"--");if(!this._findOption(Z))this.setOptionValueWithSource(J,U.defaultValue===void 0?!0:U.defaultValue,"default")}else if(U.defaultValue!==void 0)this.setOptionValueWithSource(J,U.defaultValue,"default");this.options.push(U);let Q=(Z,q,Y)=>{if(Z==null&&U.presetArg!==void 0)Z=U.presetArg;let X=this.getOptionValue(J);if(Z!==null&&U.parseArg)Z=this._callParseArg(U,Z,X,q);else if(Z!==null&&U.variadic)Z=U._concatValue(Z,X);if(Z==null)if(U.negate)Z=!1;else if(U.isBoolean()||U.optional)Z=!0;else Z="";this.setOptionValueWithSource(J,Z,Y)};if(this.on("option:"+$,(Z)=>{let q=`error: option '${U.flags}' argument '${Z}' is invalid.`;Q(Z,q,"cli")}),U.envVar)this.on("optionEnv:"+$,(Z)=>{let q=`error: option '${U.flags}' value '${Z}' from env '${U.envVar}' is invalid.`;Q(Z,q,"env")});return this}_optionEx(U,$,J,Q,Z){if(typeof $==="object"&&$ instanceof _U)throw new Error("To add an Option object use addOption() instead of option() or requiredOption()");let q=this.createOption($,J);if(q.makeOptionMandatory(!!U.mandatory),typeof Q==="function")q.default(Z).argParser(Q);else if(Q instanceof RegExp){let Y=Q;Q=(X,G)=>{let W=Y.exec(X);return W?W[0]:G},q.default(Z).argParser(Q)}else q.default(Q);return this.addOption(q)}option(U,$,J,Q){return this._optionEx({},U,$,J,Q)}requiredOption(U,$,J,Q){return this._optionEx({mandatory:!0},U,$,J,Q)}combineFlagAndOptionalValue(U=!0){return this._combineFlagAndOptionalValue=!!U,this}allowUnknownOption(U=!0){return this._allowUnknownOption=!!U,this}allowExcessArguments(U=!0){return this._allowExcessArguments=!!U,this}enablePositionalOptions(U=!0){return this._enablePositionalOptions=!!U,this}passThroughOptions(U=!0){if(this._passThroughOptions=!!U,!!this.parent&&U&&!this.parent._enablePositionalOptions)throw new Error("passThroughOptions can not be used without turning on enablePositionalOptions for parent command(s)");return this}storeOptionsAsProperties(U=!0){if(this.options.length)throw new Error("call .storeOptionsAsProperties() before adding options");return this._storeOptionsAsProperties=!!U,this}getOptionValue(U){if(this._storeOptionsAsProperties)return this[U];return this._optionValues[U]}setOptionValue(U,$){return this.setOptionValueWithSource(U,$,void 0)}setOptionValueWithSource(U,$,J){if(this._storeOptionsAsProperties)this[U]=$;else this._optionValues[U]=$;return this._optionValueSources[U]=J,this}getOptionValueSource(U){return this._optionValueSources[U]}getOptionValueSourceWithGlobals(U){let $;return this._getCommandAndAncestors().forEach((J)=>{if(J.getOptionValueSource(U)!==void 0)$=J.getOptionValueSource(U)}),$}_prepareUserArgs(U,$){if(U!==void 0&&!Array.isArray(U))throw new Error("first parameter to parse must be array or undefined");if($=$||{},U===void 0){if(U=k.argv,k.versions&&k.versions.electron)$.from="electron"}this.rawArgs=U.slice();let J;switch($.from){case void 0:case"node":this._scriptPath=U[1],J=U.slice(2);break;case"electron":if(k.defaultApp)this._scriptPath=U[1],J=U.slice(2);else J=U.slice(1);break;case"user":J=U.slice(0);break;default:throw new Error(`unexpected parse option { from: '${$.from}' }`)}if(!this._name&&this._scriptPath)this.nameFromFilename(this._scriptPath);return this._name=this._name||"program",J}parse(U,$){let J=this._prepareUserArgs(U,$);return this._parseCommand([],J),this}async parseAsync(U,$){let J=this._prepareUserArgs(U,$);return await this._parseCommand([],J),this}_executeSubCommand(U,$){$=$.slice();let J=!1,Q=[".js",".ts",".tsx",".mjs",".cjs"];function Z(W,z){let K=J0.resolve(W,z);if(UU.existsSync(K))return K;if(Q.includes(J0.extname(z)))return;let R=Q.find((T)=>UU.existsSync(`${K}${T}`));if(R)return`${K}${R}`;return}this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let q=U._executableFile||`${this._name}-${U._name}`,Y=this._executableDir||"";if(this._scriptPath){let W;try{W=UU.realpathSync(this._scriptPath)}catch(z){W=this._scriptPath}Y=J0.resolve(J0.dirname(W),Y)}if(Y){let W=Z(Y,q);if(!W&&!U._executableFile&&this._scriptPath){let z=J0.basename(this._scriptPath,J0.extname(this._scriptPath));if(z!==this._name)W=Z(Y,`${z}-${U._name}`)}q=W||q}J=Q.includes(J0.extname(q));let X;if(k.platform!=="win32")if(J)$.unshift(q),$=AU(k.execArgv).concat($),X=e0.spawn(k.argv[0],$,{stdio:"inherit"});else X=e0.spawn(q,$,{stdio:"inherit"});else $.unshift(q),$=AU(k.execArgv).concat($),X=e0.spawn(k.execPath,$,{stdio:"inherit"});if(!X.killed)["SIGUSR1","SIGUSR2","SIGTERM","SIGINT","SIGHUP"].forEach((z)=>{k.on(z,()=>{if(X.killed===!1&&X.exitCode===null)X.kill(z)})});let G=this._exitCallback;if(!G)X.on("close",k.exit.bind(k));else X.on("close",()=>{G(new $U(k.exitCode||0,"commander.executeSubCommandAsync","(close)"))});X.on("error",(W)=>{if(W.code==="ENOENT"){let z=Y?`searched for local subcommand relative to directory '${Y}'`:"no directory for search for local subcommand, use .executableDir() to supply a custom directory",K=`'${q}' does not exist
 - if '${U._name}' is not meant to be an executable command, remove description parameter from '.command()' and use '.description()' instead
 - if the default executable name is not suitable, use the executableFile option to supply a custom name or path
 - ${z}`;throw new Error(K)}else if(W.code==="EACCES")throw new Error(`'${q}' not executable`);if(!G)k.exit(1);else{let z=new $U(1,"commander.executeSubCommandAsync","(error)");z.nestedError=W,G(z)}}),this.runningCommand=X}_dispatchSubcommand(U,$,J){let Q=this._findCommand(U);if(!Q)this.help({error:!0});let Z;return Z=this._chainOrCallSubCommandHook(Z,Q,"preSubcommand"),Z=this._chainOrCall(Z,()=>{if(Q._executableHandler)this._executeSubCommand(Q,$.concat(J));else return Q._parseCommand($,J)}),Z}_dispatchHelpCommand(U){if(!U)this.help();let $=this._findCommand(U);if($&&!$._executableHandler)$.help();return this._dispatchSubcommand(U,[],[this._helpLongFlag||this._helpShortFlag])}_checkNumberOfArguments(){if(this.registeredArguments.forEach((U,$)=>{if(U.required&&this.args[$]==null)this.missingArgument(U.name())}),this.registeredArguments.length>0&&this.registeredArguments[this.registeredArguments.length-1].variadic)return;if(this.args.length>this.registeredArguments.length)this._excessArguments(this.args)}_processArguments(){let U=(J,Q,Z)=>{let q=Q;if(Q!==null&&J.parseArg){let Y=`error: command-argument value '${Q}' is invalid for argument '${J.name()}'.`;q=this._callParseArg(J,Q,Z,Y)}return q};this._checkNumberOfArguments();let $=[];this.registeredArguments.forEach((J,Q)=>{let Z=J.defaultValue;if(J.variadic){if(Q<this.args.length){if(Z=this.args.slice(Q),J.parseArg)Z=Z.reduce((q,Y)=>{return U(J,Y,q)},J.defaultValue)}else if(Z===void 0)Z=[]}else if(Q<this.args.length){if(Z=this.args[Q],J.parseArg)Z=U(J,Z,J.defaultValue)}$[Q]=Z}),this.processedArgs=$}_chainOrCall(U,$){if(U&&U.then&&typeof U.then==="function")return U.then(()=>$());return $()}_chainOrCallHooks(U,$){let J=U,Q=[];if(this._getCommandAndAncestors().reverse().filter((Z)=>Z._lifeCycleHooks[$]!==void 0).forEach((Z)=>{Z._lifeCycleHooks[$].forEach((q)=>{Q.push({hookedCommand:Z,callback:q})})}),$==="postAction")Q.reverse();return Q.forEach((Z)=>{J=this._chainOrCall(J,()=>{return Z.callback(Z.hookedCommand,this)})}),J}_chainOrCallSubCommandHook(U,$,J){let Q=U;if(this._lifeCycleHooks[J]!==void 0)this._lifeCycleHooks[J].forEach((Z)=>{Q=this._chainOrCall(Q,()=>{return Z(this,$)})});return Q}_parseCommand(U,$){let J=this.parseOptions($);if(this._parseOptionsEnv(),this._parseOptionsImplied(),U=U.concat(J.operands),$=J.unknown,this.args=U.concat($),U&&this._findCommand(U[0]))return this._dispatchSubcommand(U[0],U.slice(1),$);if(this._hasImplicitHelpCommand()&&U[0]===this._helpCommandName)return this._dispatchHelpCommand(U[1]);if(this._defaultCommandName)return wU(this,$),this._dispatchSubcommand(this._defaultCommandName,U,$);if(this.commands.length&&this.args.length===0&&!this._actionHandler&&!this._defaultCommandName)this.help({error:!0});wU(this,J.unknown),this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let Q=()=>{if(J.unknown.length>0)this.unknownOption(J.unknown[0])},Z=`command:${this.name()}`;if(this._actionHandler){Q(),this._processArguments();let q;if(q=this._chainOrCallHooks(q,"preAction"),q=this._chainOrCall(q,()=>this._actionHandler(this.processedArgs)),this.parent)q=this._chainOrCall(q,()=>{this.parent.emit(Z,U,$)});return q=this._chainOrCallHooks(q,"postAction"),q}if(this.parent&&this.parent.listenerCount(Z))Q(),this._processArguments(),this.parent.emit(Z,U,$);else if(U.length){if(this._findCommand("*"))return this._dispatchSubcommand("*",U,$);if(this.listenerCount("command:*"))this.emit("command:*",U,$);else if(this.commands.length)this.unknownCommand();else Q(),this._processArguments()}else if(this.commands.length)Q(),this.help({error:!0});else Q(),this._processArguments()}_findCommand(U){if(!U)return;return this.commands.find(($)=>$._name===U||$._aliases.includes(U))}_findOption(U){return this.options.find(($)=>$.is(U))}_checkForMissingMandatoryOptions(){this._getCommandAndAncestors().forEach((U)=>{U.options.forEach(($)=>{if($.mandatory&&U.getOptionValue($.attributeName())===void 0)U.missingMandatoryOptionValue($)})})}_checkForConflictingLocalOptions(){let U=this.options.filter((J)=>{let Q=J.attributeName();if(this.getOptionValue(Q)===void 0)return!1;return this.getOptionValueSource(Q)!=="default"});U.filter((J)=>J.conflictsWith.length>0).forEach((J)=>{let Q=U.find((Z)=>J.conflictsWith.includes(Z.attributeName()));if(Q)this._conflictingOption(J,Q)})}_checkForConflictingOptions(){this._getCommandAndAncestors().forEach((U)=>{U._checkForConflictingLocalOptions()})}parseOptions(U){let $=[],J=[],Q=$,Z=U.slice();function q(X){return X.length>1&&X[0]==="-"}let Y=null;while(Z.length){let X=Z.shift();if(X==="--"){if(Q===J)Q.push(X);Q.push(...Z);break}if(Y&&!q(X)){this.emit(`option:${Y.name()}`,X);continue}if(Y=null,q(X)){let G=this._findOption(X);if(G){if(G.required){let W=Z.shift();if(W===void 0)this.optionMissingArgument(G);this.emit(`option:${G.name()}`,W)}else if(G.optional){let W=null;if(Z.length>0&&!q(Z[0]))W=Z.shift();this.emit(`option:${G.name()}`,W)}else this.emit(`option:${G.name()}`);Y=G.variadic?G:null;continue}}if(X.length>2&&X[0]==="-"&&X[1]!=="-"){let G=this._findOption(`-${X[1]}`);if(G){if(G.required||G.optional&&this._combineFlagAndOptionalValue)this.emit(`option:${G.name()}`,X.slice(2));else this.emit(`option:${G.name()}`),Z.unshift(`-${X.slice(2)}`);continue}}if(/^--[^=]+=/.test(X)){let G=X.indexOf("="),W=this._findOption(X.slice(0,G));if(W&&(W.required||W.optional)){this.emit(`option:${W.name()}`,X.slice(G+1));continue}}if(q(X))Q=J;if((this._enablePositionalOptions||this._passThroughOptions)&&$.length===0&&J.length===0){if(this._findCommand(X)){if($.push(X),Z.length>0)J.push(...Z);break}else if(X===this._helpCommandName&&this._hasImplicitHelpCommand()){if($.push(X),Z.length>0)$.push(...Z);break}else if(this._defaultCommandName){if(J.push(X),Z.length>0)J.push(...Z);break}}if(this._passThroughOptions){if(Q.push(X),Z.length>0)Q.push(...Z);break}Q.push(X)}return{operands:$,unknown:J}}opts(){if(this._storeOptionsAsProperties){let U={},$=this.options.length;for(let J=0;J<$;J++){let Q=this.options[J].attributeName();U[Q]=Q===this._versionOptionName?this._version:this[Q]}return U}return this._optionValues}optsWithGlobals(){return this._getCommandAndAncestors().reduce((U,$)=>Object.assign(U,$.opts()),{})}error(U,$){if(this._outputConfiguration.outputError(`${U}
`,this._outputConfiguration.writeErr),typeof this._showHelpAfterError==="string")this._outputConfiguration.writeErr(`${this._showHelpAfterError}
`);else if(this._showHelpAfterError)this._outputConfiguration.writeErr(`
`),this.outputHelp({error:!0});let J=$||{},Q=J.exitCode||1,Z=J.code||"commander.error";this._exit(Q,Z,U)}_parseOptionsEnv(){this.options.forEach((U)=>{if(U.envVar&&U.envVar in k.env){let $=U.attributeName();if(this.getOptionValue($)===void 0||["default","config","env"].includes(this.getOptionValueSource($)))if(U.required||U.optional)this.emit(`optionEnv:${U.name()}`,k.env[U.envVar]);else this.emit(`optionEnv:${U.name()}`)}})}_parseOptionsImplied(){let U=new d$(this.options),$=(J)=>{return this.getOptionValue(J)!==void 0&&!["default","implied"].includes(this.getOptionValueSource(J))};this.options.filter((J)=>J.implied!==void 0&&$(J.attributeName())&&U.valueFromOption(this.getOptionValue(J.attributeName()),J)).forEach((J)=>{Object.keys(J.implied).filter((Q)=>!$(Q)).forEach((Q)=>{this.setOptionValueWithSource(Q,J.implied[Q],"implied")})})}missingArgument(U){let $=`error: missing required argument '${U}'`;this.error($,{code:"commander.missingArgument"})}optionMissingArgument(U){let $=`error: option '${U.flags}' argument missing`;this.error($,{code:"commander.optionMissingArgument"})}missingMandatoryOptionValue(U){let $=`error: required option '${U.flags}' not specified`;this.error($,{code:"commander.missingMandatoryOptionValue"})}_conflictingOption(U,$){let J=(q)=>{let Y=q.attributeName(),X=this.getOptionValue(Y),G=this.options.find((z)=>z.negate&&Y===z.attributeName()),W=this.options.find((z)=>!z.negate&&Y===z.attributeName());if(G&&(G.presetArg===void 0&&X===!1||G.presetArg!==void 0&&X===G.presetArg))return G;return W||q},Q=(q)=>{let Y=J(q),X=Y.attributeName();if(this.getOptionValueSource(X)==="env")return`environment variable '${Y.envVar}'`;return`option '${Y.flags}'`},Z=`error: ${Q(U)} cannot be used with ${Q($)}`;this.error(Z,{code:"commander.conflictingOption"})}unknownOption(U){if(this._allowUnknownOption)return;let $="";if(U.startsWith("--")&&this._showSuggestionAfterError){let Q=[],Z=this;do{let q=Z.createHelp().visibleOptions(Z).filter((Y)=>Y.long).map((Y)=>Y.long);Q=Q.concat(q),Z=Z.parent}while(Z&&!Z._enablePositionalOptions);$=LU(U,Q)}let J=`error: unknown option '${U}'${$}`;this.error(J,{code:"commander.unknownOption"})}_excessArguments(U){if(this._allowExcessArguments)return;let $=this.registeredArguments.length,J=$===1?"":"s",Z=`error: too many arguments${this.parent?` for '${this.name()}'`:""}. Expected ${$} argument${J} but got ${U.length}.`;this.error(Z,{code:"commander.excessArguments"})}unknownCommand(){let U=this.args[0],$="";if(this._showSuggestionAfterError){let Q=[];this.createHelp().visibleCommands(this).forEach((Z)=>{if(Q.push(Z.name()),Z.alias())Q.push(Z.alias())}),$=LU(U,Q)}let J=`error: unknown command '${U}'${$}`;this.error(J,{code:"commander.unknownCommand"})}version(U,$,J){if(U===void 0)return this._version;this._version=U,$=$||"-V, --version",J=J||"output the version number";let Q=this.createOption($,J);return this._versionOptionName=Q.attributeName(),this.options.push(Q),this.on("option:"+Q.name(),()=>{this._outputConfiguration.writeOut(`${U}
`),this._exit(0,"commander.version",U)}),this}description(U,$){if(U===void 0&&$===void 0)return this._description;if(this._description=U,$)this._argsDescription=$;return this}summary(U){if(U===void 0)return this._summary;return this._summary=U,this}alias(U){if(U===void 0)return this._aliases[0];let $=this;if(this.commands.length!==0&&this.commands[this.commands.length-1]._executableHandler)$=this.commands[this.commands.length-1];if(U===$._name)throw new Error("Command alias can't be the same as its name");return $._aliases.push(U),this}aliases(U){if(U===void 0)return this._aliases;return U.forEach(($)=>this.alias($)),this}usage(U){if(U===void 0){if(this._usage)return this._usage;let $=this.registeredArguments.map((J)=>{return u$(J)});return[].concat(this.options.length||this._hasHelpOption?"[options]":[],this.commands.length?"[command]":[],this.registeredArguments.length?$:[]).join(" ")}return this._usage=U,this}name(U){if(U===void 0)return this._name;return this._name=U,this}nameFromFilename(U){return this._name=J0.basename(U,J0.extname(U)),this}executableDir(U){if(U===void 0)return this._executableDir;return this._executableDir=U,this}helpInformation(U){let $=this.createHelp();if($.helpWidth===void 0)$.helpWidth=U&&U.error?this._outputConfiguration.getErrHelpWidth():this._outputConfiguration.getOutHelpWidth();return $.formatHelp(this,$)}_getHelpContext(U){U=U||{};let $={error:!!U.error},J;if($.error)J=(Q)=>this._outputConfiguration.writeErr(Q);else J=(Q)=>this._outputConfiguration.writeOut(Q);return $.write=U.write||J,$.command=this,$}outputHelp(U){let $;if(typeof U==="function")$=U,U=void 0;let J=this._getHelpContext(U);this._getCommandAndAncestors().reverse().forEach((Z)=>Z.emit("beforeAllHelp",J)),this.emit("beforeHelp",J);let Q=this.helpInformation(J);if($){if(Q=$(Q),typeof Q!=="string"&&!Buffer.isBuffer(Q))throw new Error("outputHelp callback must return a string or a Buffer")}if(J.write(Q),this._helpLongFlag)this.emit(this._helpLongFlag);this.emit("afterHelp",J),this._getCommandAndAncestors().forEach((Z)=>Z.emit("afterAllHelp",J))}helpOption(U,$){if(typeof U==="boolean")return this._hasHelpOption=U,this;this._helpFlags=U||this._helpFlags,this._helpDescription=$||this._helpDescription;let J=c$(this._helpFlags);return this._helpShortFlag=J.shortFlag,this._helpLongFlag=J.longFlag,this}help(U){this.outputHelp(U);let $=k.exitCode||0;if($===0&&U&&typeof U!=="function"&&U.error)$=1;this._exit($,"commander.help","(outputHelp)")}addHelpText(U,$){let J=["beforeAll","before","after","afterAll"];if(!J.includes(U))throw new Error(`Unexpected value for position to addHelpText.
Expecting one of '${J.join("', '")}'`);let Q=`${U}Help`;return this.on(Q,(Z)=>{let q;if(typeof $==="function")q=$({error:Z.error,command:Z.command});else q=$;if(q)Z.write(`${q}
`)}),this}}function wU(U,$){if(U._hasHelpOption&&$.find((Q)=>Q===U._helpLongFlag||Q===U._helpShortFlag))U.outputHelp(),U._exit(0,"commander.helpDisplayed","(outputHelp)")}function AU(U){return U.map(($)=>{if(!$.startsWith("--inspect"))return $;let J,Q="127.0.0.1",Z="9229",q;if((q=$.match(/^(--inspect(-brk)?)$/))!==null)J=q[1];else if((q=$.match(/^(--inspect(-brk|-port)?)=([^:]+)$/))!==null)if(J=q[1],/^\d+$/.test(q[3]))Z=q[3];else Q=q[3];else if((q=$.match(/^(--inspect(-brk|-port)?)=([^:]+):(\d+)$/))!==null)J=q[1],Q=q[3],Z=q[4];if(J&&Z!=="0")return`${J}=${Q}:${parseInt(Z)+1}`;return $})}p$.Command=JU});var vU=P0((o,kU)=>{var{Argument:s$}=g0(),{Command:OU}=EU(),{CommanderError:n$,InvalidArgumentError:CU}=A0(),{Help:r$}=a0(),{Option:o$}=t0();o=kU.exports=new OU;o.program=o;o.Command=OU;o.Option=o$;o.Argument=s$;o.Help=r$;o.CommanderError=n$;o.InvalidArgumentError=CU;o.InvalidOptionArgumentError=CU});var yU=x0(vU(),1),{program:xJ,createCommand:gJ,createArgument:hJ,createOption:mJ,CommanderError:uJ,InvalidArgumentError:lJ,InvalidOptionArgumentError:cJ,Command:bU,Argument:dJ,Option:N0,Help:pJ}=yU.default;import{existsSync as PU,accessSync as SJ,constants as jJ,realpathSync as G$}from"node:fs";import{createReadStream as W$,createWriteStream as NU}from"node:fs";import{stdin as n,stdout as W0,stderr as p,exit as r}from"node:process";class t extends Error{constructor(U){super(U);Object.setPrototypeOf(this,new.target.prototype),this.name=new.target.name,this.stack=void 0}}class s extends t{}class S0 extends t{}class QU extends t{}class h0 extends t{}class T0 extends t{}class Q0 extends t{}class e extends t{}class c extends t{}class j0 extends t{}function fU(){return typeof process!=="undefined"&&typeof process.versions==="object"&&!0}function D0(...U){let $=U.reduce((Z,q)=>Z+q.byteLength,0),J=new Uint8Array($),Q=0;for(let Z of U)J.set(Z,Q),Q+=Z.byteLength;return J}function _0(...U){try{let $=D0(...U);if(fU())return Buffer.from($).toString("base64");let J="";for(let Q=0;Q<$.length;Q++)J+=String.fromCharCode($[Q]);return btoa(J)}catch{throw new QU("Base64 Encoding Error")}}function E0(U){try{if(!/^[A-Za-z0-9+/]+={0,2}$/.test(U)||U.length%4!==0)throw new Error("Invalid Base64");if(fU())return new Uint8Array(Buffer.from(U,"base64"));let $=atob(U),J=new Uint8Array($.length);for(let Q=0;Q<$.length;Q++)J[Q]=$.charCodeAt(Q);return J}catch{throw new S0(`Invalid Base64: length=${U.length}, content='${U.slice(0,12)}…'`)}}function d(U){let $=U.value.length,J=new Array($).fill("\x00").join("");U.value=J}function ZU(U,$,J){if($<0||J<0||$+J>U)throw new RangeError("read() slice exceeds data bounds")}import{promises as a$}from"fs";class qU{src;#U=null;constructor(U){this.src=U}get length(){if(this.src instanceof Uint8Array)return this.src.byteLength;if(this.src instanceof Blob)return this.src.size;return this.ensureUint8().byteLength}async read(U,$){if(ZU(this.length,U,$),this.src instanceof Uint8Array)return this.src.slice(U,U+$);if(this.src instanceof Blob){let J=await this.src.slice(U,U+$).arrayBuffer();return new Uint8Array(J)}return this.ensureUint8().slice(U,U+$)}ensureUint8(){if(!this.#U)this.#U=E0(this.src);return this.#U}}class O0{fd;length;constructor(U,$){this.fd=U;this.length=$}static async open(U){let $=await a$.open(U,"r"),J=await $.stat();return new O0($,J.size)}async read(U,$){ZU(this.length,U,$);let J=Buffer.allocUnsafe($);return await this.fd.read(J,0,$,U),new Uint8Array(J)}async close(){await this.fd.close()}}class u{static byId=new Map;static register(U){if(this.byId.has(U.id))throw new h0(`Scheme ${U.id} already registered`);this.byId.set(U.id,U)}static get(U){let $=this.byId.get(U);if(!$)throw new h0(`Unknown scheme: ${U}`);return $}static get current(){return this.get(0)}}class V0{p;static IV_LENGTH=12;static TAG_LENGTH=16;IV_LENGTH=V0.IV_LENGTH;TAG_LENGTH=V0.TAG_LENGTH;key;aad=new Uint8Array(0);constructor(U){this.p=U}async setKey(U){this.key=U}async encryptChunk(U){let $=this.p.getRandomValues(new Uint8Array(V0.IV_LENGTH)),J=this.aad.length?{name:"AES-GCM",iv:$,additionalData:this.aad}:{name:"AES-GCM",iv:$},Q=await this.p.subtle.encrypt(J,this.requireKey(),U),Z=new Uint8Array(Q);U.fill(0);let q=new Uint8Array($.length+Z.length);return q.set($,0),q.set(Z,$.length),q}async decryptChunk(U){let $=U.slice(0,V0.IV_LENGTH),J=U.slice(V0.IV_LENGTH),Q=this.aad.length?{name:"AES-GCM",iv:$,additionalData:this.aad}:{name:"AES-GCM",iv:$};try{let Z=await this.p.subtle.decrypt(Q,this.requireKey(),J);return new Uint8Array(Z)}catch{throw new c("Decryption failed: wrong passphrase or corrupted ciphertext")}}zeroKey(){this.key=null}setAAD(U){this.aad=U&&U.byteLength?new Uint8Array(U):new Uint8Array(0)}requireKey(){if(!this.key)throw new Error("Encryption key not set");return this.key}}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function gU(U){return U instanceof Uint8Array||ArrayBuffer.isView(U)&&U.constructor.name==="Uint8Array"}function m0(U){if(typeof U!=="boolean")throw new Error(`boolean expected, not ${U}`)}function u0(U){if(!Number.isSafeInteger(U)||U<0)throw new Error("positive integer expected, got "+U)}function l(U,...$){if(!gU(U))throw new Error("Uint8Array expected");if($.length>0&&!$.includes(U.length))throw new Error("Uint8Array expected of length "+$+", got length="+U.length)}function YU(U,$=!0){if(U.destroyed)throw new Error("Hash instance has been destroyed");if($&&U.finished)throw new Error("Hash#digest() has already been called")}function hU(U,$){l(U);let J=$.outputLen;if(U.length<J)throw new Error("digestInto() expects output buffer of length at least "+J)}function Z0(U){return new Uint32Array(U.buffer,U.byteOffset,Math.floor(U.byteLength/4))}function q0(...U){for(let $=0;$<U.length;$++)U[$].fill(0)}function t$(U){return new DataView(U.buffer,U.byteOffset,U.byteLength)}var e$=(()=>new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68)();function UJ(U){if(typeof U!=="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(U))}function l0(U){if(typeof U==="string")U=UJ(U);else if(gU(U))U=c0(U);else throw new Error("Uint8Array expected, got "+typeof U);return U}function mU(U,$){if($==null||typeof $!=="object")throw new Error("options must be defined");return Object.assign(U,$)}function uU(U,$){if(U.length!==$.length)return!1;let J=0;for(let Q=0;Q<U.length;Q++)J|=U[Q]^$[Q];return J===0}var GU=(U,$)=>{function J(Q,...Z){if(l(Q),!e$)throw new Error("Non little-endian hardware is not yet supported");if(U.nonceLength!==void 0){let z=Z[0];if(!z)throw new Error("nonce / iv required");if(U.varSizeNonce)l(z);else l(z,U.nonceLength)}let q=U.tagLength;if(q&&Z[1]!==void 0)l(Z[1]);let Y=$(Q,...Z),X=(z,K)=>{if(K!==void 0){if(z!==2)throw new Error("cipher output not supported");l(K)}},G=!1;return{encrypt(z,K){if(G)throw new Error("cannot encrypt() twice with same key + nonce");return G=!0,l(z),X(Y.encrypt.length,K),Y.encrypt(z,K)},decrypt(z,K){if(l(z),q&&z.length<q)throw new Error("invalid ciphertext length: smaller than tagLength="+q);return X(Y.decrypt.length,K),Y.decrypt(z,K)}}}return Object.assign(J,U),J};function XU(U,$,J=!0){if($===void 0)return new Uint8Array(U);if($.length!==U)throw new Error("invalid output length, expected "+U+", got: "+$.length);if(J&&!$J($))throw new Error("invalid output, must be aligned");return $}function xU(U,$,J,Q){if(typeof U.setBigUint64==="function")return U.setBigUint64($,J,Q);let Z=BigInt(32),q=BigInt(4294967295),Y=Number(J>>Z&q),X=Number(J&q),G=Q?4:0,W=Q?0:4;U.setUint32($+G,Y,Q),U.setUint32($+W,X,Q)}function lU(U,$,J){m0(J);let Q=new Uint8Array(16),Z=t$(Q);return xU(Z,0,BigInt($),J),xU(Z,8,BigInt(U),J),Q}function $J(U){return U.byteOffset%4===0}function c0(U){return Uint8Array.from(U)}var dU=(U)=>Uint8Array.from(U.split("").map(($)=>$.charCodeAt(0))),JJ=dU("expand 16-byte k"),QJ=dU("expand 32-byte k"),ZJ=Z0(JJ),qJ=Z0(QJ);function P(U,$){return U<<$|U>>>32-$}function WU(U){return U.byteOffset%4===0}var d0=64,YJ=16,pU=4294967295,cU=new Uint32Array;function GJ(U,$,J,Q,Z,q,Y,X){let G=Z.length,W=new Uint8Array(d0),z=Z0(W),K=WU(Z)&&WU(q),R=K?Z0(Z):cU,T=K?Z0(q):cU;for(let V=0;V<G;Y++){if(U($,J,Q,z,Y,X),Y>=pU)throw new Error("arx: counter overflow");let N=Math.min(d0,G-V);if(K&&N===d0){let H=V/4;if(V%4!==0)throw new Error("arx: invalid block position");for(let I=0,F;I<YJ;I++)F=H+I,T[F]=R[F]^z[I];V+=d0;continue}for(let H=0,I;H<N;H++)I=V+H,q[I]=Z[I]^W[H];V+=N}}function zU(U,$){let{allowShortKeys:J,extendNonceFn:Q,counterLength:Z,counterRight:q,rounds:Y}=mU({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},$);if(typeof U!=="function")throw new Error("core must be a function");return u0(Z),u0(Y),m0(q),m0(J),(X,G,W,z,K=0)=>{l(X),l(G),l(W);let R=W.length;if(z===void 0)z=new Uint8Array(R);if(l(z),u0(K),K<0||K>=pU)throw new Error("arx: counter overflow");if(z.length<R)throw new Error(`arx: output (${z.length}) is shorter than data (${R})`);let T=[],V=X.length,N,H;if(V===32)T.push(N=c0(X)),H=qJ;else if(V===16&&J)N=new Uint8Array(32),N.set(X),N.set(X,16),H=ZJ,T.push(N);else throw new Error(`arx: invalid 32-byte key, got length=${V}`);if(!WU(G))T.push(G=c0(G));let I=Z0(N);if(Q){if(G.length!==24)throw new Error("arx: extended nonce must be 24 bytes");Q(H,I,Z0(G.subarray(0,16)),I),G=G.subarray(16)}let F=16-Z;if(F!==G.length)throw new Error(`arx: nonce must be ${F} or 16 bytes`);if(F!==12){let x=new Uint8Array(12);x.set(G,q?0:12-G.length),G=x,T.push(G)}let M=Z0(G);return GJ(U,H,I,M,W,z,K,Y),q0(...T),z}}var g=(U,$)=>U[$++]&255|(U[$++]&255)<<8;class iU{constructor(U){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,U=l0(U),l(U,32);let $=g(U,0),J=g(U,2),Q=g(U,4),Z=g(U,6),q=g(U,8),Y=g(U,10),X=g(U,12),G=g(U,14);this.r[0]=$&8191,this.r[1]=($>>>13|J<<3)&8191,this.r[2]=(J>>>10|Q<<6)&7939,this.r[3]=(Q>>>7|Z<<9)&8191,this.r[4]=(Z>>>4|q<<12)&255,this.r[5]=q>>>1&8190,this.r[6]=(q>>>14|Y<<2)&8191,this.r[7]=(Y>>>11|X<<5)&8065,this.r[8]=(X>>>8|G<<8)&8191,this.r[9]=G>>>5&127;for(let W=0;W<8;W++)this.pad[W]=g(U,16+2*W)}process(U,$,J=!1){let Q=J?0:2048,{h:Z,r:q}=this,Y=q[0],X=q[1],G=q[2],W=q[3],z=q[4],K=q[5],R=q[6],T=q[7],V=q[8],N=q[9],H=g(U,$+0),I=g(U,$+2),F=g(U,$+4),M=g(U,$+6),x=g(U,$+8),z0=g(U,$+10),h=g(U,$+12),m=g(U,$+14),S=Z[0]+(H&8191),j=Z[1]+((H>>>13|I<<3)&8191),D=Z[2]+((I>>>10|F<<6)&8191),_=Z[3]+((F>>>7|M<<9)&8191),L=Z[4]+((M>>>4|x<<12)&8191),w=Z[5]+(x>>>1&8191),A=Z[6]+((x>>>14|z0<<2)&8191),E=Z[7]+((z0>>>11|h<<5)&8191),O=Z[8]+((h>>>8|m<<8)&8191),C=Z[9]+(m>>>5|Q),B=0,y=B+S*Y+j*(5*N)+D*(5*V)+_*(5*T)+L*(5*R);B=y>>>13,y&=8191,y+=w*(5*K)+A*(5*z)+E*(5*W)+O*(5*G)+C*(5*X),B+=y>>>13,y&=8191;let b=B+S*X+j*Y+D*(5*N)+_*(5*V)+L*(5*T);B=b>>>13,b&=8191,b+=w*(5*R)+A*(5*K)+E*(5*z)+O*(5*W)+C*(5*G),B+=b>>>13,b&=8191;let f=B+S*G+j*X+D*Y+_*(5*N)+L*(5*V);B=f>>>13,f&=8191,f+=w*(5*T)+A*(5*R)+E*(5*K)+O*(5*z)+C*(5*W),B+=f>>>13,f&=8191;let v=B+S*W+j*G+D*X+_*Y+L*(5*N);B=v>>>13,v&=8191,v+=w*(5*V)+A*(5*T)+E*(5*R)+O*(5*K)+C*(5*z),B+=v>>>13,v&=8191;let $0=B+S*z+j*W+D*G+_*X+L*Y;B=$0>>>13,$0&=8191,$0+=w*(5*N)+A*(5*V)+E*(5*T)+O*(5*R)+C*(5*K),B+=$0>>>13,$0&=8191;let B0=B+S*K+j*z+D*W+_*G+L*X;B=B0>>>13,B0&=8191,B0+=w*Y+A*(5*N)+E*(5*V)+O*(5*T)+C*(5*R),B+=B0>>>13,B0&=8191;let H0=B+S*R+j*K+D*z+_*W+L*G;B=H0>>>13,H0&=8191,H0+=w*X+A*Y+E*(5*N)+O*(5*V)+C*(5*T),B+=H0>>>13,H0&=8191;let I0=B+S*T+j*R+D*K+_*z+L*W;B=I0>>>13,I0&=8191,I0+=w*G+A*X+E*Y+O*(5*N)+C*(5*V),B+=I0>>>13,I0&=8191;let M0=B+S*V+j*T+D*R+_*K+L*z;B=M0>>>13,M0&=8191,M0+=w*W+A*G+E*X+O*Y+C*(5*N),B+=M0>>>13,M0&=8191;let F0=B+S*N+j*V+D*T+_*R+L*K;B=F0>>>13,F0&=8191,F0+=w*z+A*W+E*G+O*X+C*Y,B+=F0>>>13,F0&=8191,B=(B<<2)+B|0,B=B+y|0,y=B&8191,B=B>>>13,b+=B,Z[0]=y,Z[1]=b,Z[2]=f,Z[3]=v,Z[4]=$0,Z[5]=B0,Z[6]=H0,Z[7]=I0,Z[8]=M0,Z[9]=F0}finalize(){let{h:U,pad:$}=this,J=new Uint16Array(10),Q=U[1]>>>13;U[1]&=8191;for(let Y=2;Y<10;Y++)U[Y]+=Q,Q=U[Y]>>>13,U[Y]&=8191;U[0]+=Q*5,Q=U[0]>>>13,U[0]&=8191,U[1]+=Q,Q=U[1]>>>13,U[1]&=8191,U[2]+=Q,J[0]=U[0]+5,Q=J[0]>>>13,J[0]&=8191;for(let Y=1;Y<10;Y++)J[Y]=U[Y]+Q,Q=J[Y]>>>13,J[Y]&=8191;J[9]-=8192;let Z=(Q^1)-1;for(let Y=0;Y<10;Y++)J[Y]&=Z;Z=~Z;for(let Y=0;Y<10;Y++)U[Y]=U[Y]&Z|J[Y];U[0]=(U[0]|U[1]<<13)&65535,U[1]=(U[1]>>>3|U[2]<<10)&65535,U[2]=(U[2]>>>6|U[3]<<7)&65535,U[3]=(U[3]>>>9|U[4]<<4)&65535,U[4]=(U[4]>>>12|U[5]<<1|U[6]<<14)&65535,U[5]=(U[6]>>>2|U[7]<<11)&65535,U[6]=(U[7]>>>5|U[8]<<8)&65535,U[7]=(U[8]>>>8|U[9]<<5)&65535;let q=U[0]+$[0];U[0]=q&65535;for(let Y=1;Y<8;Y++)q=(U[Y]+$[Y]|0)+(q>>>16)|0,U[Y]=q&65535;q0(J)}update(U){YU(this),U=l0(U),l(U);let{buffer:$,blockLen:J}=this,Q=U.length;for(let Z=0;Z<Q;){let q=Math.min(J-this.pos,Q-Z);if(q===J){for(;J<=Q-Z;Z+=J)this.process(U,Z);continue}if($.set(U.subarray(Z,Z+q),this.pos),this.pos+=q,Z+=q,this.pos===J)this.process($,0,!1),this.pos=0}return this}destroy(){q0(this.h,this.r,this.buffer,this.pad)}digestInto(U){YU(this),hU(U,this),this.finished=!0;let{buffer:$,h:J}=this,{pos:Q}=this;if(Q){$[Q++]=1;for(;Q<16;Q++)$[Q]=0;this.process($,0,!0)}this.finalize();let Z=0;for(let q=0;q<8;q++)U[Z++]=J[q]>>>0,U[Z++]=J[q]>>>8;return U}digest(){let{buffer:U,outputLen:$}=this;this.digestInto(U);let J=U.slice(0,$);return this.destroy(),J}}function XJ(U){let $=(Q,Z)=>U(Z).update(l0(Q)).digest(),J=U(new Uint8Array(32));return $.outputLen=J.outputLen,$.blockLen=J.blockLen,$.create=(Q)=>U(Q),$}var sU=XJ((U)=>new iU(U));function oU(U,$,J,Q,Z,q=20){let Y=U[0],X=U[1],G=U[2],W=U[3],z=$[0],K=$[1],R=$[2],T=$[3],V=$[4],N=$[5],H=$[6],I=$[7],F=Z,M=J[0],x=J[1],z0=J[2],h=Y,m=X,S=G,j=W,D=z,_=K,L=R,w=T,A=V,E=N,O=H,C=I,B=F,y=M,b=x,f=z0;for(let $0=0;$0<q;$0+=2)h=h+D|0,B=P(B^h,16),A=A+B|0,D=P(D^A,12),h=h+D|0,B=P(B^h,8),A=A+B|0,D=P(D^A,7),m=m+_|0,y=P(y^m,16),E=E+y|0,_=P(_^E,12),m=m+_|0,y=P(y^m,8),E=E+y|0,_=P(_^E,7),S=S+L|0,b=P(b^S,16),O=O+b|0,L=P(L^O,12),S=S+L|0,b=P(b^S,8),O=O+b|0,L=P(L^O,7),j=j+w|0,f=P(f^j,16),C=C+f|0,w=P(w^C,12),j=j+w|0,f=P(f^j,8),C=C+f|0,w=P(w^C,7),h=h+_|0,f=P(f^h,16),O=O+f|0,_=P(_^O,12),h=h+_|0,f=P(f^h,8),O=O+f|0,_=P(_^O,7),m=m+L|0,B=P(B^m,16),C=C+B|0,L=P(L^C,12),m=m+L|0,B=P(B^m,8),C=C+B|0,L=P(L^C,7),S=S+w|0,y=P(y^S,16),A=A+y|0,w=P(w^A,12),S=S+w|0,y=P(y^S,8),A=A+y|0,w=P(w^A,7),j=j+D|0,b=P(b^j,16),E=E+b|0,D=P(D^E,12),j=j+D|0,b=P(b^j,8),E=E+b|0,D=P(D^E,7);let v=0;Q[v++]=Y+h|0,Q[v++]=X+m|0,Q[v++]=G+S|0,Q[v++]=W+j|0,Q[v++]=z+D|0,Q[v++]=K+_|0,Q[v++]=R+L|0,Q[v++]=T+w|0,Q[v++]=V+A|0,Q[v++]=N+E|0,Q[v++]=H+O|0,Q[v++]=I+C|0,Q[v++]=F+B|0,Q[v++]=M+y|0,Q[v++]=x+b|0,Q[v++]=z0+f|0}function WJ(U,$,J,Q){let Z=U[0],q=U[1],Y=U[2],X=U[3],G=$[0],W=$[1],z=$[2],K=$[3],R=$[4],T=$[5],V=$[6],N=$[7],H=J[0],I=J[1],F=J[2],M=J[3];for(let z0=0;z0<20;z0+=2)Z=Z+G|0,H=P(H^Z,16),R=R+H|0,G=P(G^R,12),Z=Z+G|0,H=P(H^Z,8),R=R+H|0,G=P(G^R,7),q=q+W|0,I=P(I^q,16),T=T+I|0,W=P(W^T,12),q=q+W|0,I=P(I^q,8),T=T+I|0,W=P(W^T,7),Y=Y+z|0,F=P(F^Y,16),V=V+F|0,z=P(z^V,12),Y=Y+z|0,F=P(F^Y,8),V=V+F|0,z=P(z^V,7),X=X+K|0,M=P(M^X,16),N=N+M|0,K=P(K^N,12),X=X+K|0,M=P(M^X,8),N=N+M|0,K=P(K^N,7),Z=Z+W|0,M=P(M^Z,16),V=V+M|0,W=P(W^V,12),Z=Z+W|0,M=P(M^Z,8),V=V+M|0,W=P(W^V,7),q=q+z|0,H=P(H^q,16),N=N+H|0,z=P(z^N,12),q=q+z|0,H=P(H^q,8),N=N+H|0,z=P(z^N,7),Y=Y+K|0,I=P(I^Y,16),R=R+I|0,K=P(K^R,12),Y=Y+K|0,I=P(I^Y,8),R=R+I|0,K=P(K^R,7),X=X+G|0,F=P(F^X,16),T=T+F|0,G=P(G^T,12),X=X+G|0,F=P(F^X,8),T=T+F|0,G=P(G^T,7);let x=0;Q[x++]=Z,Q[x++]=q,Q[x++]=Y,Q[x++]=X,Q[x++]=H,Q[x++]=I,Q[x++]=F,Q[x++]=M}var zJ=zU(oU,{counterRight:!1,counterLength:4,allowShortKeys:!1}),KJ=zU(oU,{counterRight:!1,counterLength:8,extendNonceFn:WJ,allowShortKeys:!1});var TJ=new Uint8Array(16),nU=(U,$)=>{U.update($);let J=$.length%16;if(J)U.update(TJ.subarray(J))},VJ=new Uint8Array(32);function rU(U,$,J,Q,Z){let q=U($,J,VJ),Y=sU.create(q);if(Z)nU(Y,Z);nU(Y,Q);let X=lU(Q.length,Z?Z.length:0,!0);Y.update(X);let G=Y.digest();return q0(q,X),G}var aU=(U)=>($,J,Q)=>{return{encrypt(q,Y){let X=q.length;Y=XU(X+16,Y,!1),Y.set(q);let G=Y.subarray(0,-16);U($,J,G,G,1);let W=rU(U,$,J,G,Q);return Y.set(W,X),q0(W),Y},decrypt(q,Y){Y=XU(q.length-16,Y,!1);let X=q.subarray(0,-16),G=q.subarray(-16),W=rU(U,$,J,X,Q);if(!uU(G,W))throw new Error("invalid tag");return Y.set(q.subarray(0,-16)),U($,J,Y,Y,1),q0(W),Y}}},RQ=GU({blockSize:64,nonceLength:12,tagLength:16},aU(zJ)),C0=GU({blockSize:64,nonceLength:24,tagLength:16},aU(KJ));class Y0{p;static IV_LENGTH=24;static TAG_LENGTH=16;IV_LENGTH=Y0.IV_LENGTH;TAG_LENGTH=Y0.TAG_LENGTH;key;aad=new Uint8Array(0);constructor(U){this.p=U}async setKey(U){this.key=new Uint8Array(await this.p.subtle.exportKey("raw",U))}async encryptChunk(U){if(!this.key)throw new Error("Key not set");let $=this.p.getRandomValues(new Uint8Array(Y0.IV_LENGTH)),Q=(this.aad.length?C0(this.key,$,this.aad):C0(this.key,$)).encrypt(U);U.fill(0);let Z=new Uint8Array($.length+Q.length);return Z.set($,0),Z.set(Q,$.length),Z}async decryptChunk(U){if(!this.key)throw new Error("Key not set");if(U.byteLength<Y0.IV_LENGTH+16)throw new c("Invalid ciphertext: too short.");let $=U.slice(0,Y0.IV_LENGTH),J=U.slice(Y0.IV_LENGTH),Q=this.aad.length?C0(this.key,$,this.aad):C0(this.key,$);try{return Q.decrypt(J)}catch{throw new c("Decryption failed: wrong passphrase or corrupted ciphertext")}}zeroKey(){if(this.key)this.key.fill(0)}setAAD(U){this.aad=U&&U.byteLength?new Uint8Array(U):new Uint8Array(0)}}import*as p0 from"argon2-browser";async function RJ(){if(typeof window!=="undefined")return;if(globalThis.loadArgon2WasmModule)return;try{let{createRequire:U}=await import("node:module"),{readFile:$}=await import("node:fs/promises"),J=U(import.meta.url),Q=J.resolve("argon2-browser/dist/argon2.js"),Z=J.resolve("argon2-browser/dist/argon2.wasm");globalThis.loadArgon2WasmModule=async()=>{let q=new Uint8Array(await $(Z));return globalThis.Module={wasmBinary:q,locateFile:(Y)=>Y==="argon2.wasm"?Z:Y},J(Q)}}catch{}}async function tU(U,$,J,Q){if(Q==="node"){let q=await import("@node-rs/argon2"),Y=typeof U==="string"?Buffer.from(U,"utf8"):Buffer.from(U),G=(await q.hash(Y,{salt:$,timeCost:J.time,memoryCost:J.mem,parallelism:J.parallelism,outputLen:32,algorithm:q.Algorithm.Argon2id})).split("$").pop();if(!G)throw new Error("Unexpected argon2 hash format");let W=Buffer.from(G,"base64");return $.fill(0),Y.fill(0),{hash:new Uint8Array(W)}}if(Q==="browser")return await RJ(),p0.hash({pass:U,salt:$,time:J.time,mem:J.mem,parallelism:J.parallelism,hashLen:32,type:p0.ArgonType.Argon2id}).then((Z)=>{if(!Z||!Z.hash)throw new Q0("Failed to produce key derivation");return{hash:Z.hash}}).catch((Z)=>{let q=Z instanceof Error?Z.message:typeof Z==="string"?Z:"Unknown error";throw new Q0(`argon2-browser failure: ${q}`)});throw new Error(`Unsupported environment: ${Q}`)}class i0{presets;exportExtractable;name="argon2id";constructor(U,$=!1){this.presets=U;this.exportExtractable=$}async derive(U,$,J,Q){let{hash:Z}=await tU(U,$,this.presets[J],Q.isNode?"node":"browser");if(this.exportExtractable)return Q.subtle.importKey("raw",Z,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);else return Q.subtle.importKey("raw",Z,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}}var eU={low:{time:5,mem:65536,parallelism:1},middle:{time:20,mem:65536,parallelism:1},high:{time:40,mem:65536,parallelism:1}},PJ={id:0,cipher:V0,kdf:new i0(eU),saltLengths:{low:12,high:16},difficulties:eU,defaultChunkSize:524288};u.register(PJ);var U$={low:{time:5,mem:65536,parallelism:2},middle:{time:10,mem:98304,parallelism:4},high:{time:20,mem:98304,parallelism:4}},NJ={id:1,cipher:Y0,kdf:new i0(U$,!0),saltLengths:{low:12,high:16},difficulties:U$,defaultChunkSize:524288};u.register(NJ);var s0=1;function k0(U,$,J,Q,Z){let q={low:0,middle:1,high:2};if(!($ in q))throw new TypeError(`Unsupported difficulty: ${$}`);let Y=q[$],X=U<<5|(J==="high"?1:0)<<2|Y,G=D0(new Uint8Array([s0,X]),Q);if(Z)Z.setAAD(G);return G}function U0(U,$){if(U[0]!==s0)throw new s("Invalid input format. The input is unknown.");if(U.length<14)throw new s("Invalid input format. Header too short.");try{let J=U[1],Q=J>>5,Z=J>>2&1?"high":"low",q=J&3,Y=["low","middle","high"][q],X=u.get(Q).saltLengths[Z],G=2+X;if(U.length<G)throw new s("Invalid input format. Header truncated.");if($)$.setAAD(U.subarray(0,G));let W=U.slice(2,2+X);return{scheme:Q,difficulty:Y,saltStrength:Z,salt:W,headerLen:G}}catch(J){throw new T0(J instanceof Error?J.message:String(J))}}async function n0(U){if(U instanceof Uint8Array)return U;if(U instanceof ArrayBuffer)return new Uint8Array(U);return new Uint8Array(await U.arrayBuffer())}function KU(U){let $=new Uint8Array(4);return new DataView($.buffer).setUint32(0,U,!1),$}function $$(U,$=0){if(U.length-$<4)throw new RangeError("Not enough bytes for frame header");return new DataView(U.buffer,U.byteOffset+$,4).getUint32(0,!1)}var G0=4;class v0{engine;chunkSize;buffer=new Uint8Array(0);constructor(U,$=524288){this.engine=U;this.chunkSize=$}toTransformStream(){return new TransformStream({transform:async(U,$)=>{await this.transform(await n0(U),$)},flush:async(U)=>this.flush(U)})}async transform(U,$){if(U.length>Math.min(this.chunkSize*4,67108864))throw new RangeError(`Input block (${U.length} B) exceeds maximum allowed ${Math.min(this.chunkSize*4,67108864)} B`);let Q=new Uint8Array(this.buffer.length+U.length);Q.set(this.buffer),Q.set(U,this.buffer.length);let Z=0;while(Q.length-Z>=this.chunkSize){let q=Q.slice(Z,Z+this.chunkSize);Z+=this.chunkSize;let Y=await this.engine.encryptChunk(q),X=new Uint8Array(G0+Y.length);X.set(KU(Y.length)),X.set(Y,G0),$.enqueue(X)}this.buffer=Q.slice(Z)}async flush(U){if(!this.buffer.length)return;let $=await this.engine.encryptChunk(this.buffer),J=new Uint8Array(G0+$.length);J.set(KU($.length)),J.set($,G0),U.enqueue(J),this.buffer=new Uint8Array(0),this.engine.zeroKey()}}class L0{engine;chunkSize;buffer=new Uint8Array(0);constructor(U,$=524288){this.engine=U;this.chunkSize=$}toTransformStream(){return new TransformStream({transform:async(U,$)=>{await this.transform(await n0(U),$)},flush:async(U)=>this.flush(U)})}async transform(U,$){let J=new Uint8Array(this.buffer.length+U.length);J.set(this.buffer),J.set(U,this.buffer.length);let Q=0;while(!0){if(J.length-Q<G0)break;let Z=$$(J,Q);if(Z>this.chunkSize*2)throw new c(`Frame length ${Z} exceeds …`);if(J.length-Q-G0<Z)break;Q+=G0;let q=J.slice(Q,Q+Z);Q+=Z;try{let Y=await this.engine.decryptChunk(q);$.enqueue(Y)}catch(Y){throw Y instanceof c?Y:new c("Decryption failed: Wrong passphrase or corrupted ciphertext")}}this.buffer=J.slice(Q)}async flush(U){await this.transform(new Uint8Array(0),U),this.buffer=new Uint8Array(0),this.engine.zeroKey()}}async function J$(U,$){let J=U.getReader(),Q=$&&$.length?[$]:[];try{while(!0){let{value:X,done:G}=await J.read();if(G)break;Q.push(X)}}finally{J.releaseLock()}let Z=Q.reduce((X,G)=>X+G.byteLength,0),q=new Uint8Array(Z),Y=0;for(let X of Q)q.set(X,Y),Y+=X.byteLength;return q}class w0{engine;chunkSize;constructor(U,$=524288){this.engine=U;this.chunkSize=$}encryptionStream(){let U=new v0(this.engine,this.chunkSize).toTransformStream();return{writable:U.writable,readable:U.readable}}decryptionStream(U){let $=U,J=new TransformStream({transform(Z,q){if($===0){q.enqueue(Z);return}if(Z.byteLength<=$){$-=Z.byteLength;return}q.enqueue(Z.slice($)),$=0}}),Q=new L0(this.engine,this.chunkSize).toTransformStream();return{writable:J.writable,readable:J.readable.pipeThrough(Q)}}async collect(U,$,J=null){return J$(U.pipeThrough($),J??void 0)}getEngine(){return this.engine}}function Q$(U){try{if(U)U.fill(0)}catch{}}function BJ(U){let $="";for(let J=0;J<U.length;J++){let Q=U[J].toString(16).padStart(2,"0");$+=Q}return $}class X0{bytes;destroyed=!1;static from(U){if(U instanceof X0)return U;if(typeof U==="string")return new X0(new TextEncoder().encode(U));if(U instanceof Uint8Array)return new X0(U);throw new TypeError("ConvertibleInput: unsupported input type")}constructor(U){this.bytes=U}toUint8Array(){if(this.destroyed)throw new Error("ConvertibleInput: already cleared");return this.bytes}clear(){if(!this.destroyed)Q$(this.bytes),this.bytes=new Uint8Array(0),this.destroyed=!0}}class y0{bytes;destroyed=!1;constructor(U){this.bytes=U}get uint8array(){if(this.destroyed)throw new Error("ConvertibleOutput: already cleared");return this.bytes}get base64(){if(this.destroyed)throw new Error("ConvertibleOutput: already cleared");return _0(this.bytes)}get hex(){if(this.destroyed)throw new Error("ConvertibleOutput: already cleared");return BJ(this.bytes)}get text(){if(this.destroyed)throw new Error("ConvertibleOutput: already cleared");return new TextDecoder().decode(this.bytes)}clear(){if(!this.destroyed)Q$(this.bytes),this.bytes=new Uint8Array(0),this.destroyed=!0}toString(){return this.base64}}function Z$(U=0,$=console.info){return{level:U,log(J,Q){if(J<=U)$(`${J}| ${Q}`)}}}var q$=new WeakMap;class R0{static getEngine(U,$){let J=q$.get(U);if(!J)J=new Map,q$.set(U,J);let Q=J.get($);if(Q)return Q;let Z=u.get($);return Q={desc:Z,cipher:new Z.cipher(U),kdf:Z.kdf,chunkSize:Z.defaultChunkSize,provider:U},J.set($,Q),Q}static async deriveKey(U,$,J,Q){try{let Z=await U.kdf.derive($.value,J,Q,U.provider);await U.cipher.setKey(Z)}catch(Z){let q=Z instanceof Error?Z.message:String(Z);throw new Q0(q)}finally{d($)}}}class i{provider;v;cipher;kdf;chunkSize;stream;difficulty;saltStrength;engines=new Map;log;constructor(U,$={}){this.provider=U;this.v=u.get($.scheme??u.current.id),this.cipher=new this.v.cipher(U),this.kdf=this.v.kdf,this.chunkSize=this.setChunkSize($.chunkSize??this.v.defaultChunkSize),this.stream=new w0(this.cipher,this.chunkSize),this.difficulty=$.difficulty??"middle",this.saltStrength=$.saltStrength??"high",this.log=Z$($.verbose??0,$.logger)}static async isEncrypted(U){try{return await i.peekHeader(U),!0}catch{return!1}}static async decodeHeader(U){let $=await i.peekHeader(U),J=U0($);return{scheme:J.scheme,difficulty:J.difficulty,salt:_0(J.salt),saltBytes:J.salt,saltLength:J.salt.byteLength}}static async headerDecode(U){return this.decodeHeader(U)}static isRandomAccessSource(U){return typeof U==="object"&&U!==null&&typeof U.read==="function"}static async decodeData(U){let $=i.isRandomAccessSource(U)?U:new qU(U),J=await $.read(0,Math.min(256,$.length)),Q=await i.peekHeader(J),{scheme:Z,headerLen:q}=U0(Q),Y=$.length,X=Y-q;if(X<=0)throw new s("Payload is empty");let G=await $.read(q,4),W=new DataView(G.buffer,G.byteOffset,4).getUint32(0,!1);if(W+4<=X&&W>=28){let V=W,N=q,H=0,I=0;while(N+4<=Y){let F=await $.read(N,4),M=new DataView(F.buffer,F.byteOffset,4).getUint32(0,!1);if(M===0||N+4+M>Y)break;H++,I+=M,N+=4+M}return{isChunked:!0,chunks:{chunkSize:V,count:H,totalPayload:I}}}let K=await $.read(q,X),R=u.get(Z).cipher.IV_LENGTH,T=u.get(Z).cipher.TAG_LENGTH;if(K.length<R+T)throw new s("Ciphertext too short for IV & tag");return{isChunked:!1,payloadLength:X-R-T,params:{iv:K.slice(0,R),ivLength:R,tag:K.slice(K.length-T),tagLength:T}}}setDifficulty(U){this.difficulty=U}getDifficulty(){return this.difficulty}setScheme(U){this.v=u.get(U),this.cipher=new this.v.cipher(this.provider),this.kdf=this.v.kdf,this.stream=new w0(this.cipher,this.chunkSize)}getScheme(){return this.v.id}setSaltDifficulty(U){this.saltStrength=U}getSaltDifficulty(){return this.saltStrength}setChunkSize(U){let J=U,Q;if(J==null)Q=this.v.defaultChunkSize;else{if(Q=Number(J),!Number.isInteger(Q)||Q<1)throw new Error(`Invalid chunkSize: ${J}. Must be a positive integer.`);if(Q>134217728)throw new RangeError("chunkSize cannot exceed 134217728 bytes.")}if(this.chunkSize=Q,this.stream)this.stream=new w0(this.cipher,this.chunkSize);return Q}getChunkSize(){return this.chunkSize}setVerbose(U){this.log.level=U}getVerbose(){return this.log.level}async encryptText(U,$){if($===null)throw new e("Password can't be null");let J={value:$};try{if($==="")this.log.log(0,"Empty passphrase provided to encryptText");this.log.log(1,`Start text encryption, scheme: ${this.getScheme()}`);let Q=X0.from(U),Z=Q.toUint8Array();this.log.log(2,"Deriving key for text encryption");let q=this.genSalt();await this.deriveKey(J,q),d(J),$=null,this.log.log(3,`Salt generated: ${_0(q)}, KDF difficulty: ${this.difficulty}`),this.log.log(3,"Encoding header");let Y=k0(this.v.id,this.difficulty,this.saltStrength,q,this.cipher);this.log.log(2,"Encrypting text data");let X=await this.cipher.encryptChunk(Z);this.cipher.zeroKey();try{Q.clear()}catch{}let G=D0(Y,X);return this.log.log(1,"Encryption finished"),new y0(G)}catch(Q){throw new e(Q instanceof Error?Q.message:String(Q))}}async decryptText(U,$){if($===null)throw new e("Password can't be null");let J={value:$};try{if($==="")this.log.log(0,"Empty passphrase provided to decryptText");this.log.log(1,`Start text decryption, Version ${this.getScheme()}`);let Q;if(typeof U==="string")this.log.log(3,"Decoding Base64 ciphertext"),Q=E0(U);else if(U instanceof Uint8Array)Q=U;else if(U instanceof X0)Q=U.toUint8Array();else throw new S0("Unsupported ciphertext input type");this.log.log(3,"Start header decoding");let Z=U0(Q);this.log.log(3,"Selecting decryption engine");let q=R0.getEngine(this.provider,Z.scheme);this.log.log(2,`Deriving key via engine for scheme: ${Z.scheme}`),this.log.log(3,`Salt use: ${_0(Z.salt)}, KDF difficulty: ${Z.difficulty}`);try{await R0.deriveKey(q,J,Z.salt,Z.difficulty)}finally{d(J),$=null}this.log.log(2,"Decrypting text data"),U0(Q,q.cipher);let Y=await q.cipher.decryptChunk(Q.slice(Z.headerLen));if(q.cipher.zeroKey(),U instanceof X0)try{U.clear()}catch{}return this.log.log(1,"Decryption finished"),new y0(Y)}catch(Q){if(Q instanceof c||Q instanceof s||Q instanceof T0||Q instanceof S0||Q instanceof Q0)throw Q;throw new c("Decryption failed: wrong passphrase or corrupted ciphertext")}}async encryptFile(U,$){if($===null)throw new e("Password can't be null");let J={value:$};try{if(U.size===0){let Y=this.genSalt();await this.deriveKey(J,Y),d(J),$=null;let X=k0(this.v.id,this.difficulty,this.saltStrength,Y);return new Blob([X],{type:"application/octet-stream"})}this.log.log(2,"Deriving key for file encryption");let Q=this.genSalt();await this.deriveKey(J,Q),d(J),$=null;let Z=k0(this.v.id,this.difficulty,this.saltStrength,Q,this.stream.getEngine()),q=await this.stream.collect(U.stream(),new v0(this.cipher,this.chunkSize).toTransformStream(),Z);return new Blob([q],{type:"application/octet-stream"})}catch(Q){throw new e(Q instanceof Error?Q.message:String(Q))}}async decryptFile(U,$){if($===null)throw new e("Password can't be null");let J={value:$};try{let Q=await i.peekHeader(U),Z=U0(Q),q=R0.getEngine(this.provider,Z.scheme);try{await R0.deriveKey(q,J,Z.salt,Z.difficulty)}finally{d(J),$=null}if(U.size===Z.headerLen)return new Blob([],{type:"application/octet-stream"});this.log.log(2,"Decrypting file data");let Y=new w0(q.cipher,q.chunkSize);U0(Q,Y.getEngine());let X=await Y.collect(U.slice(Z.headerLen).stream(),new L0(q.cipher,q.chunkSize).toTransformStream());return new Blob([X],{type:"application/octet-stream"})}catch(Q){if(Q instanceof c)throw Q;throw new c(Q instanceof Error?Q.message:String(Q))}}async createEncryptionStream(U){if(U===null)throw new e("Password can't be null");let $={value:U};this.log.log(2,"Deriving key for stream encryption");let J=this.genSalt();await this.deriveKey($,J),d($),U=null;let Q=k0(this.v.id,this.difficulty,this.saltStrength,J,this.stream.getEngine()),Z=this.stream.encryptionStream();return{header:Q,writable:Z.writable,readable:Z.readable}}async createDecryptionStream(U){if(U===null)throw new e("Password can't be null");let $=this.provider,J={value:U},Q=new Uint8Array(0),Z=null,q=65536,Y=14,X=async(G,W)=>{let z=G.getReader();while(!0){let{value:K,done:R}=await z.read();if(R)break;W.enqueue(K)}};return new TransformStream({transform:async(G,W)=>{if(!Z){if(G&&G.byteLength){if(Q.byteLength+G.byteLength>q){d(J),W.error(new s(`Header not found within ${q} bytes`));return}Q=D0(Q,G)}if(Q.byteLength<Y)return;let K=Q[1],R=K>>5,T=K>>2&1?"high":"low",V=0;try{V=2+u.get(R).saltLengths[T]}catch(M){d(J),W.error(new T0(M instanceof Error?M.message:String(M)));return}if(Q.byteLength<V)return;let N=Q.subarray(0,V),H;try{H=U0(N)}catch(M){d(J),W.error(M instanceof Error?M:new T0("Invalid header"));return}let I=R0.getEngine($,H.scheme);try{await R0.deriveKey(I,J,H.salt,H.difficulty)}finally{d(J),U=null}U0(N,I.cipher),Z=new L0(I.cipher,I.chunkSize).toTransformStream(),X(Z.readable,W).catch((M)=>W.error(M));let F=Q.subarray(V);if(Q=new Uint8Array(0),F.byteLength){let M=Z.writable.getWriter();await M.write(F),M.releaseLock()}return}let z=Z.writable.getWriter();await z.write(G),z.releaseLock()},flush:async()=>{if(!Z)throw d(J),new s("Header not found before end of stream");let G=Z.writable.getWriter();await G.close(),G.releaseLock()}})}async deriveKey(U,$,J=this.difficulty){let Q=performance.now();try{let Z=await this.kdf.derive(U.value,$,J,this.provider);d(U),await this.cipher.setKey(Z),this.log.log(3,`Key derivation completed in ${(performance.now()-Q).toFixed(1)} ms`)}catch(Z){throw new Q0(Z instanceof Error?Z.message:String(Z))}}genSalt(U=this.saltStrength){let $=this.v.saltLengths[U];return this.provider.getRandomValues(new Uint8Array($))}static async peekHeader(U){let $=await this.readAsUint8(U);if($ instanceof Uint8Array){if($.length<2)throw new s("Input too short");let{headerLen:J}=U0($.length>=16?$:Uint8Array.from($));if($.length<J)throw new s("Incomplete header");return $.slice(0,J)}throw new T0("Unsupported input type")}static async readAsUint8(U){if(typeof U==="string")return E0(U);if(U instanceof Blob){let $=U.slice(0,64);return new Uint8Array(await $.arrayBuffer())}return U}}import{webcrypto as HJ,randomFillSync as IJ}from"node:crypto";var Y$={subtle:HJ.subtle,getRandomValues(U){return IJ(U),U},isNode:!0};function b0(U){return new i(Y$,U)}import{dirname as DJ,resolve as X$,sep as _J,isAbsolute as LJ}from"node:path";import{Readable as MJ,Writable as FJ}from"node:stream";function TU(U){return MJ.toWeb(U)}function VU(U){return FJ.toWeb(U)}import{promises as f0}from"fs";import*as T$ from"os";import*as RU from"path";var wJ="2.1.3",AJ=process.cwd();async function r0(){if(!n.isTTY)throw new Error("STDIN not a TTY; use --pass");p.write("Passphrase: "),n.setRawMode?.(!0),n.resume(),n.setEncoding("utf8");let U="";return new Promise(($)=>{function J(){n.setRawMode?.(!1),n.pause(),p.write(`
`),n.off("data",Q),$(U)}function Q(Z){if(Z==="\x03")r(130);if(Z==="\r"||Z===`
`)return J();if(Z==="\b"||Z===""){U=U.slice(0,-1);return}U+=Z}n.on("data",Q)})}function z$(U,$=AJ){if(U==="-")return;let J=G$($),Q=LJ(U)?X$(U):X$(J,U),Z=DJ(Q);if(!G$(Z).startsWith(J+_J))throw new j0("Refusing to write outside of root directory.");if(!PU(Z))throw new j0(`Output directory does not exist: ${Z}`);try{SJ(Z,jJ.W_OK)}catch{throw new j0("Output directory is not writeable")}return Q}async function K$(){let U=[];for await(let $ of n)U.push($);return Buffer.concat(U).toString("utf8")}var a=new bU;a.name("cryptit").version(wJ).description(`Text and File Encryption Utility
Scheme 0: AES-GCM (Native) / Argon2id (Single Thread)
Scheme 1: XChaCha20-Poly1305 (JS Engine) / Argon2id (Parallel)`).addOption(new N0("-S, --scheme <0-1>","encryption scheme version").argParser((U)=>{let $=Number(U);if(!Number.isInteger($)||$<0||$>7)throw new Error("Version size must be a integer between 0 and 7");return $}).default(0,"0")).addOption(new N0("-p, --pass <passphrase>","passphrase (prompt if omitted)").hideHelp().argParser((U)=>{if(!U.trim())throw new Error("Passphrase cannot be empty");return U})).addOption(new N0("-d, --difficulty <level>","argon2 difficulty").choices(["low","middle","high"]).default("middle","middle")).addOption(new N0("-s, --salt-strength <variant>","salt length variant").choices(["low","high"]).default("high","high")).addOption(new N0("-c, --chunk-size <bytes>","chunk size in bytes").argParser((U)=>{let $=Number(U);if(!Number.isInteger($)||$<=0)throw new Error("Chunk size must be a positive integer");return $}).default(524288,"512*1024")).addOption(new N0("-v, --verbose","increase verbosity (use multiple times)").default(0).argParser((U,$)=>{return $+1}));process.on("uncaughtException",(U)=>{if(U instanceof Error){let $=U.constructor.name,J=U.message;p.write(`Error [${$}]: ${J}
`)}else p.write(`Error [Unknown]: ${String(U)}
`);r(1)});process.on("unhandledRejection",(U)=>{if(U instanceof Error){let $=U.constructor.name,J=U.message;p.write(`Error [${$}]: ${J}
`)}else p.write(`Error [Unknown]: ${String(U)}
`);r(1)});a.command("decode [src]").description("Show Cryptit header information plus payload details; omit arg or use - to read from STDIN").action(async(U)=>{let $=!U||U==="-";async function J(G){if(G.length<2)throw new Error("Input too short for header");let W=G.subarray(0,Math.min(256,G.length)),z=await i.decodeHeader(W),K=await i.decodeData(G);if(delete z.saltBytes,K.isChunked){let{chunkSize:V,count:N,totalPayload:H}=K.chunks;return{...z,isChunked:!0,chunks:{chunkSize:V,count:N,totalPayload:H}}}let R=Buffer.from(K.params.iv).toString("base64"),T=Buffer.from(K.params.tag).toString("base64");return{...z,isChunked:!1,payloadLength:K.payloadLength,params:{iv:R,ivLength:K.params.ivLength,tag:T,tagLength:K.params.tagLength}}}async function Q(G){let W=await G.read(0,Math.min(256,G.length)),z=await i.decodeHeader(W),K=await i.decodeData(G);if(delete z.saltBytes,K.isChunked){let{chunkSize:V,count:N,totalPayload:H}=K.chunks;return{...z,isChunked:!0,chunks:{chunkSize:V,count:N,totalPayload:H}}}let R=Buffer.from(K.params.iv).toString("base64"),T=Buffer.from(K.params.tag).toString("base64");return{...z,isChunked:!1,payloadLength:K.payloadLength,params:{iv:R,tag:T}}}async function Z(){let G=Number(process.env.CRYPTIT_STDIN_MAX_BYTES),W=Number.isFinite(G)&&G>0?Math.floor(G):10073741824,z=await f0.mkdtemp(RU.join(T$.tmpdir(),"cryptit-")),K=RU.join(z,"stdin.bin"),R=NU(K,{flags:"w"}),T=0;try{for await(let V of process.stdin){let N=Buffer.isBuffer(V)?V:Buffer.from(V);if(T+=N.length,T>W)throw R.destroy(),await f0.rm(z,{recursive:!0,force:!0}).catch(()=>{}),new j0(`STDIN exceeds maximum allowed size (${W} bytes). Aborting.`);if(!R.write(N))await new Promise((H)=>R.once("drain",H))}return await new Promise((V,N)=>{R.end(()=>V()),R.on("error",N)}),K}catch(V){throw R.destroy(),await f0.rm(z,{recursive:!0,force:!0}).catch(()=>{}),V}}if(!$&&U){let G=await O0.open(U);try{let W=await Q(G);W0.write(JSON.stringify(W,null,2)+`
`)}finally{await G.close()}return}if($){let G=await Z(),W=await O0.open(G);try{try{let V=await Q(W);W0.write(JSON.stringify(V,null,2)+`
`);return}catch{}}finally{await W.close()}let z=(await f0.readFile(G,{encoding:"utf8"})).trim();if(await f0.unlink(G),!(/^[A-Za-z0-9+/]+={0,2}$/.test(z)&&z.length%4===0))p.write(`Error: Input neither valid Cryptit binary nor Base-64 text
`),r(1);let R=Buffer.from(z,"base64"),T=await J(new Uint8Array(R));W0.write(JSON.stringify(T,null,2)+`
`);return}let q=Buffer.from(U,"utf8"),Y=q.toString("utf8").trim(),X=/^[A-Za-z0-9+/]+={0,2}$/.test(Y)&&Y.length%4===0;try{if(X){let G=Buffer.from(Y,"base64"),W=await J(new Uint8Array(G));W0.write(JSON.stringify(W,null,2)+`
`)}else{let G=await J(new Uint8Array(q));W0.write(JSON.stringify(G,null,2)+`
`)}}catch(G){let W=G instanceof Error?G.message:String(G);p.write(`Error: ${W}
`),r(1)}});a.command("encrypt <src>").description("Encrypt file; use - for STDIN, --out - for STDOUT").option("-o, --out <file>","output file (default STDOUT)","-").action(async(U,$)=>{if(U!=="-"&&!PU(U))p.write(`Error: input file not found: ${U}
`),r(1);let J=a.opts(),Q=b0({difficulty:J.difficulty,saltStrength:J.saltStrength,chunkSize:J.chunkSize,verbose:J.verbose,scheme:J.scheme}),Z=J.pass??(n.isTTY?await r0():(()=>{p.write(`Use --pass when piping via STDIN
`),r(1)})());try{z$($.out)}catch(T){p.write(`Error: ${T.message}
`),r(1)}let q=U==="-"?n:W$(U),Y=$.out==="-"?W0:NU($.out),{header:X,writable:G,readable:W}=await Q.createEncryptionStream(Z),z=TU(q),K=VU(Y),R=K.getWriter();await R.write(X),R.releaseLock(),await Promise.all([z.pipeTo(G),W.pipeTo(K)])});a.command("decrypt <src>").description("Decrypt file; use - for STDIN, --out - for STDOUT").option("-o, --out <file>","output file (default STDOUT)","-").action(async(U,$)=>{if(U!=="-"&&!PU(U))p.write(`Error: input file not found: ${U}
`),r(1);let J=a.opts(),Q=b0({difficulty:J.difficulty,saltStrength:J.saltStrength,chunkSize:J.chunkSize,verbose:J.verbose,scheme:J.scheme});try{z$($.out)}catch(z){p.write(`Error: ${z.message}
`),r(1)}let Z=J.pass??await r0(),q=U==="-"?n:W$(U),Y=$.out==="-"?W0:NU($.out),X=TU(q),G=VU(Y),W=await Q.createDecryptionStream(Z);await Promise.all([X.pipeTo(W.writable),W.readable.pipeTo(G)])});a.command("encrypt-text [text]").description("Encrypt plaintext; omit arg to read from STDIN").action(async(U)=>{let $=a.opts(),J=b0({difficulty:$.difficulty,saltStrength:$.saltStrength,verbose:$.verbose,scheme:$.scheme}),Q=$.pass??(n.isTTY?await r0():(()=>{p.write(`Use --pass when piping via STDIN
`),r(1)})()),Z=U??await K$(),q=await J.encryptText(Z,Q);W0.write(q.base64+`
`)});a.command("decrypt-text [b64]").description("Decrypt Base64 ciphertext; omit arg to read from STDIN").action(async(U)=>{let $=a.opts(),J=b0({difficulty:$.difficulty,saltStrength:$.saltStrength,verbose:$.verbose,scheme:$.scheme}),Q=$.pass??await r0(),Z=U??(await K$()).trim();if(!/^[A-Za-z0-9+/]+={0,2}$/.test(Z))p.write(`Error: ciphertext does not look like Base64
`),r(1);let q=await J.decryptText(Z,Q);W0.write(q.text+`
`)});a.parse();

//# debugId=E8052360EBBD504664756E2164756E21

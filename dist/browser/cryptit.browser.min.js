var O6=Object.create;var{getPrototypeOf:N6,defineProperty:_A,getOwnPropertyNames:tj,getOwnPropertyDescriptor:z6}=Object,wj=Object.prototype.hasOwnProperty;var sA=(A,j,n)=>{n=A!=null?O6(N6(A)):{};let f=j||!A||!A.__esModule?_A(n,"default",{value:A,enumerable:!0}):n;for(let i of tj(A))if(!wj.call(f,i))_A(f,i,{get:()=>A[i],enumerable:!0});return f},ej=new WeakMap,Bj=(A)=>{var j=ej.get(A),n;if(j)return j;if(j=_A({},"__esModule",{value:!0}),A&&typeof A==="object"||typeof A==="function")tj(A).map((f)=>!wj.call(j,f)&&_A(j,f,{get:()=>A[f],enumerable:!(n=z6(A,f))||n.enumerable}));return ej.set(A,j),j},oA=(A,j)=>()=>(j||A((j={exports:{}}).exports,j),j.exports);var W6=(A,j)=>{for(var n in j)_A(A,n,{get:j[n],enumerable:!0,configurable:!0,set:(f)=>j[n]=()=>f})};var J6=(A,j)=>()=>(A&&(j=A(A=0)),j);var dA=((A)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(A,{get:(j,n)=>(typeof require!=="undefined"?require:j)[n]}):A)(function(A){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+A+'" is not supported')});var vj={};W6(vj,{sep:()=>oj,resolve:()=>ZA,relative:()=>Mj,posix:()=>hj,parse:()=>sj,normalize:()=>qj,join:()=>Cj,isAbsolute:()=>Lj,format:()=>yj,extname:()=>uj,dirname:()=>lj,delimiter:()=>dj,default:()=>h6,basename:()=>bj,_makeLong:()=>cj});function h(A){if(typeof A!=="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(A))}function Zj(A,j){var n="",f=0,i=-1,q=0,v;for(var r=0;r<=A.length;++r){if(r<A.length)v=A.charCodeAt(r);else if(v===47)break;else v=47;if(v===47){if(i===r-1||q===1);else if(i!==r-1&&q===2){if(n.length<2||f!==2||n.charCodeAt(n.length-1)!==46||n.charCodeAt(n.length-2)!==46){if(n.length>2){var k=n.lastIndexOf("/");if(k!==n.length-1){if(k===-1)n="",f=0;else n=n.slice(0,k),f=n.length-1-n.lastIndexOf("/");i=r,q=0;continue}}else if(n.length===2||n.length===1){n="",f=0,i=r,q=0;continue}}if(j){if(n.length>0)n+="/..";else n="..";f=2}}else{if(n.length>0)n+="/"+A.slice(i+1,r);else n=A.slice(i+1,r);f=r-i-1}i=r,q=0}else if(v===46&&q!==-1)++q;else q=-1}return n}function d6(A,j){var n=j.dir||j.root,f=j.base||(j.name||"")+(j.ext||"");if(!n)return f;if(n===j.root)return n+f;return n+A+f}function ZA(){var A="",j=!1,n;for(var f=arguments.length-1;f>=-1&&!j;f--){var i;if(f>=0)i=arguments[f];else{if(n===void 0)n=process.cwd();i=n}if(h(i),i.length===0)continue;A=i+"/"+A,j=i.charCodeAt(0)===47}if(A=Zj(A,!j),j)if(A.length>0)return"/"+A;else return"/";else if(A.length>0)return A;else return"."}function qj(A){if(h(A),A.length===0)return".";var j=A.charCodeAt(0)===47,n=A.charCodeAt(A.length-1)===47;if(A=Zj(A,!j),A.length===0&&!j)A=".";if(A.length>0&&n)A+="/";if(j)return"/"+A;return A}function Lj(A){return h(A),A.length>0&&A.charCodeAt(0)===47}function Cj(){if(arguments.length===0)return".";var A;for(var j=0;j<arguments.length;++j){var n=arguments[j];if(h(n),n.length>0)if(A===void 0)A=n;else A+="/"+n}if(A===void 0)return".";return qj(A)}function Mj(A,j){if(h(A),h(j),A===j)return"";if(A=ZA(A),j=ZA(j),A===j)return"";var n=1;for(;n<A.length;++n)if(A.charCodeAt(n)!==47)break;var f=A.length,i=f-n,q=1;for(;q<j.length;++q)if(j.charCodeAt(q)!==47)break;var v=j.length,r=v-q,k=i<r?i:r,F=-1,I=0;for(;I<=k;++I){if(I===k){if(r>k){if(j.charCodeAt(q+I)===47)return j.slice(q+I+1);else if(I===0)return j.slice(q+I)}else if(i>k){if(A.charCodeAt(n+I)===47)F=I;else if(I===0)F=0}break}var _=A.charCodeAt(n+I),t=j.charCodeAt(q+I);if(_!==t)break;else if(_===47)F=I}var e="";for(I=n+F+1;I<=f;++I)if(I===f||A.charCodeAt(I)===47)if(e.length===0)e+="..";else e+="/..";if(e.length>0)return e+j.slice(q+F);else{if(q+=F,j.charCodeAt(q)===47)++q;return j.slice(q)}}function cj(A){return A}function lj(A){if(h(A),A.length===0)return".";var j=A.charCodeAt(0),n=j===47,f=-1,i=!0;for(var q=A.length-1;q>=1;--q)if(j=A.charCodeAt(q),j===47){if(!i){f=q;break}}else i=!1;if(f===-1)return n?"/":".";if(n&&f===1)return"//";return A.slice(0,f)}function bj(A,j){if(j!==void 0&&typeof j!=="string")throw new TypeError('"ext" argument must be a string');h(A);var n=0,f=-1,i=!0,q;if(j!==void 0&&j.length>0&&j.length<=A.length){if(j.length===A.length&&j===A)return"";var v=j.length-1,r=-1;for(q=A.length-1;q>=0;--q){var k=A.charCodeAt(q);if(k===47){if(!i){n=q+1;break}}else{if(r===-1)i=!1,r=q+1;if(v>=0)if(k===j.charCodeAt(v)){if(--v===-1)f=q}else v=-1,f=r}}if(n===f)f=r;else if(f===-1)f=A.length;return A.slice(n,f)}else{for(q=A.length-1;q>=0;--q)if(A.charCodeAt(q)===47){if(!i){n=q+1;break}}else if(f===-1)i=!1,f=q+1;if(f===-1)return"";return A.slice(n,f)}}function uj(A){h(A);var j=-1,n=0,f=-1,i=!0,q=0;for(var v=A.length-1;v>=0;--v){var r=A.charCodeAt(v);if(r===47){if(!i){n=v+1;break}continue}if(f===-1)i=!1,f=v+1;if(r===46){if(j===-1)j=v;else if(q!==1)q=1}else if(j!==-1)q=-1}if(j===-1||f===-1||q===0||q===1&&j===f-1&&j===n+1)return"";return A.slice(j,f)}function yj(A){if(A===null||typeof A!=="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof A);return d6("/",A)}function sj(A){h(A);var j={root:"",dir:"",base:"",ext:"",name:""};if(A.length===0)return j;var n=A.charCodeAt(0),f=n===47,i;if(f)j.root="/",i=1;else i=0;var q=-1,v=0,r=-1,k=!0,F=A.length-1,I=0;for(;F>=i;--F){if(n=A.charCodeAt(F),n===47){if(!k){v=F+1;break}continue}if(r===-1)k=!1,r=F+1;if(n===46){if(q===-1)q=F;else if(I!==1)I=1}else if(q!==-1)I=-1}if(q===-1||r===-1||I===0||I===1&&q===r-1&&q===v+1){if(r!==-1)if(v===0&&f)j.base=j.name=A.slice(1,r);else j.base=j.name=A.slice(v,r)}else{if(v===0&&f)j.name=A.slice(1,q),j.base=A.slice(1,r);else j.name=A.slice(v,q),j.base=A.slice(v,r);j.ext=A.slice(q,r)}if(v>0)j.dir=A.slice(0,v-1);else if(f)j.dir="/";return j}var oj="/",dj=":",hj,h6;var rj=J6(()=>{hj=((A)=>(A.posix=A,A))({resolve:ZA,normalize:qj,isAbsolute:Lj,join:Cj,relative:Mj,_makeLong:cj,dirname:lj,basename:bj,extname:uj,format:yj,parse:sj,sep:oj,delimiter:dj,win32:null,posix:null}),h6=hj});var _j=oA((rf,$A)=>{var __dirname="/Users/maxim/Projects/Private/Sites/cryptit/node_modules/argon2-browser/dist",E=typeof self!=="undefined"&&typeof self.Module!=="undefined"?self.Module:{},p6=E,tA={},iA;for(iA in E)if(E.hasOwnProperty(iA))tA[iA]=E[iA];var wA=[],A6="./this.program",Ij=function(A,j){throw j},cA=!1,rA=!1,Rj=!1,j6=!1;cA=typeof window==="object";rA=typeof importScripts==="function";Rj=typeof process==="object"&&typeof process.versions==="object"&&typeof process.versions.node==="string";j6=!cA&&!Rj&&!rA;var s="";function a6(A){if(E.locateFile)return E.locateFile(A,s);return s+A}var LA,Fj,BA,x6,Ej,kj;if(Rj){if(rA)s=(rj(),Bj(vj)).dirname(s)+"/";else s=__dirname+"/";if(LA=function A(j,n){if(!Ej)Ej=(()=>({}));if(!kj)kj=(rj(),Bj(vj));return j=kj.normalize(j),Ej.readFileSync(j,n?null:"utf8")},BA=function A(j){var n=LA(j,!0);if(!n.buffer)n=new Uint8Array(n);return pj(n.buffer),n},process.argv.length>1)A6=process.argv[1].replace(/\\/g,"/");if(wA=process.argv.slice(2),typeof $A!=="undefined")$A.exports=E;process.on("uncaughtException",function(A){if(!(A instanceof Xn))throw A}),process.on("unhandledRejection",mA),Ij=function(A){process.exit(A)},E.inspect=function(){return"[Emscripten Module object]"}}else if(j6){if(typeof read!="undefined")LA=function A(j){return read(j)};if(BA=function A(j){var n;if(typeof readbuffer==="function")return new Uint8Array(readbuffer(j));return n=read(j,"binary"),pj(typeof n==="object"),n},typeof scriptArgs!="undefined")wA=scriptArgs;else if(typeof arguments!="undefined")wA=arguments;if(typeof quit==="function")Ij=function(A){quit(A)};if(typeof print!=="undefined"){if(typeof console==="undefined")console={};console.log=print,console.warn=console.error=typeof printErr!=="undefined"?printErr:print}}else if(cA||rA){if(rA)s=self.location.href;else if(typeof document!=="undefined"&&document.currentScript)s=document.currentScript.src;if(s.indexOf("blob:")!==0)s=s.substr(0,s.lastIndexOf("/")+1);else s="";{if(LA=function(A){var j=new XMLHttpRequest;return j.open("GET",A,!1),j.send(null),j.responseText},rA)BA=function(A){var j=new XMLHttpRequest;return j.open("GET",A,!1),j.responseType="arraybuffer",j.send(null),new Uint8Array(j.response)};Fj=function(A,j,n){var f=new XMLHttpRequest;f.open("GET",A,!0),f.responseType="arraybuffer",f.onload=function(){if(f.status==200||f.status==0&&f.response){j(f.response);return}n()},f.onerror=n,f.send(null)}}x6=function(A){document.title=A}}var ff=E.print||console.log.bind(console),eA=E.printErr||console.warn.bind(console);for(iA in tA)if(tA.hasOwnProperty(iA))E[iA]=tA[iA];tA=null;if(E.arguments)wA=E.arguments;if(E.thisProgram)A6=E.thisProgram;if(E.quit)Ij=E.quit;var gA;if(E.wasmBinary)gA=E.wasmBinary;var qf=E.noExitRuntime||!0;if(typeof WebAssembly!=="object")mA("no native wasm support detected");var TA,n6=!1,An;function pj(A,j){if(!A)mA("Assertion failed: "+j)}var jn=0,nn=1;function fn(A,j){var n;if(j==nn)n=_6(A.length);else n=K6(A.length);if(A.subarray||A.slice)kA.set(A,n);else kA.set(new Uint8Array(A),n);return n}var aj=typeof TextDecoder!=="undefined"?new TextDecoder("utf8"):void 0;function qn(A,j,n){var f=j+n,i=j;while(A[i]&&!(i>=f))++i;if(i-j>16&&A.subarray&&aj)return aj.decode(A.subarray(j,i));else{var q="";while(j<i){var v=A[j++];if(!(v&128)){q+=String.fromCharCode(v);continue}var r=A[j++]&63;if((v&224)==192){q+=String.fromCharCode((v&31)<<6|r);continue}var k=A[j++]&63;if((v&240)==224)v=(v&15)<<12|r<<6|k;else v=(v&7)<<18|r<<12|k<<6|A[j++]&63;if(v<65536)q+=String.fromCharCode(v);else{var F=v-65536;q+=String.fromCharCode(55296|F>>10,56320|F&1023)}}}return q}function vn(A,j){return A?qn(kA,A,j):""}function rn(A,j){if(A%j>0)A+=j-A%j;return A}var Pj,f6,kA,i6,q6,v6,r6,E6,k6;function $6(A){Pj=A,E.HEAP8=f6=new Int8Array(A),E.HEAP16=i6=new Int16Array(A),E.HEAP32=v6=new Int32Array(A),E.HEAPU8=kA=new Uint8Array(A),E.HEAPU16=q6=new Uint16Array(A),E.HEAPU32=r6=new Uint32Array(A),E.HEAPF32=E6=new Float32Array(A),E.HEAPF64=k6=new Float64Array(A)}var vf=E.INITIAL_MEMORY||16777216,CA,I6=[],F6=[],R6=[],En=!1;function kn(){if(E.preRun){if(typeof E.preRun=="function")E.preRun=[E.preRun];while(E.preRun.length)Fn(E.preRun.shift())}Gj(I6)}function $n(){En=!0,Gj(F6)}function In(){if(E.postRun){if(typeof E.postRun=="function")E.postRun=[E.postRun];while(E.postRun.length)Pn(E.postRun.shift())}Gj(R6)}function Fn(A){I6.unshift(A)}function Rn(A){F6.unshift(A)}function Pn(A){R6.unshift(A)}var EA=0,$j=null,HA=null;function Gn(A){if(EA++,E.monitorRunDependencies)E.monitorRunDependencies(EA)}function Kn(A){if(EA--,E.monitorRunDependencies)E.monitorRunDependencies(EA);if(EA==0){if($j!==null)clearInterval($j),$j=null;if(HA){var j=HA;HA=null,j()}}}E.preloadedImages={};E.preloadedAudios={};function mA(A){if(E.onAbort)E.onAbort(A);A+="",eA(A),n6=!0,An=1,A="abort("+A+"). Build with -s ASSERTIONS=1 for more info.";var j=new WebAssembly.RuntimeError(A);throw j}var _n="data:application/octet-stream;base64,";function P6(A){return A.startsWith(_n)}function G6(A){return A.startsWith("file://")}var b="argon2.wasm";if(!P6(b))b=a6(b);function xj(A){try{if(A==b&&gA)return new Uint8Array(gA);if(BA)return BA(A);else throw"both async and sync fetching of the wasm failed"}catch(j){mA(j)}}function Un(){if(!gA&&(cA||rA)){if(typeof fetch==="function"&&!G6(b))return fetch(b,{credentials:"same-origin"}).then(function(A){if(!A.ok)throw"failed to load wasm binary file at '"+b+"'";return A.arrayBuffer()}).catch(function(){return xj(b)});else if(Fj)return new Promise(function(A,j){Fj(b,function(n){A(new Uint8Array(n))},j)})}return Promise.resolve().then(function(){return xj(b)})}function en(){var A={a:Hn};function j(v,r){var k=v.exports;E.asm=k,TA=E.asm.c,$6(TA.buffer),CA=E.asm.k,Rn(E.asm.d),Kn("wasm-instantiate")}Gn("wasm-instantiate");function n(v){j(v.instance)}function f(v){return Un().then(function(r){var k=WebAssembly.instantiate(r,A);return k}).then(v,function(r){eA("failed to asynchronously prepare wasm: "+r),mA(r)})}function i(){if(!gA&&typeof WebAssembly.instantiateStreaming==="function"&&!P6(b)&&!G6(b)&&typeof fetch==="function")return fetch(b,{credentials:"same-origin"}).then(function(v){var r=WebAssembly.instantiateStreaming(v,A);return r.then(n,function(k){return eA("wasm streaming compile failed: "+k),eA("falling back to ArrayBuffer instantiation"),f(n)})});else return f(n)}if(E.instantiateWasm)try{var q=E.instantiateWasm(A,j);return q}catch(v){return eA("Module.instantiateWasm callback failed with error: "+v),!1}return i(),{}}function Gj(A){while(A.length>0){var j=A.shift();if(typeof j=="function"){j(E);continue}var n=j.func;if(typeof n==="number")if(j.arg===void 0)CA.get(n)();else CA.get(n)(j.arg);else n(j.arg===void 0?null:j.arg)}}function tn(A,j,n){kA.copyWithin(A,j,j+n)}function wn(A){try{return TA.grow(A-Pj.byteLength+65535>>>16),$6(TA.buffer),1}catch(j){}}function Bn(A){var j=kA.length;A=A>>>0;var n=2147418112;if(A>n)return!1;for(var f=1;f<=4;f*=2){var i=j*(1+0.2/f);i=Math.min(i,A+100663296);var q=Math.min(n,rn(Math.max(A,i),65536)),v=wn(q);if(v)return!0}return!1}var Hn={a:tn,b:Bn},gn=en(),Tn=E.___wasm_call_ctors=function(){return(Tn=E.___wasm_call_ctors=E.asm.d).apply(null,arguments)},mn=E._argon2_hash=function(){return(mn=E._argon2_hash=E.asm.e).apply(null,arguments)},K6=E._malloc=function(){return(K6=E._malloc=E.asm.f).apply(null,arguments)},Sn=E._free=function(){return(Sn=E._free=E.asm.g).apply(null,arguments)},On=E._argon2_verify=function(){return(On=E._argon2_verify=E.asm.h).apply(null,arguments)},Nn=E._argon2_error_message=function(){return(Nn=E._argon2_error_message=E.asm.i).apply(null,arguments)},zn=E._argon2_encodedlen=function(){return(zn=E._argon2_encodedlen=E.asm.j).apply(null,arguments)},Wn=E._argon2_hash_ext=function(){return(Wn=E._argon2_hash_ext=E.asm.l).apply(null,arguments)},Jn=E._argon2_verify_ext=function(){return(Jn=E._argon2_verify_ext=E.asm.m).apply(null,arguments)},_6=E.stackAlloc=function(){return(_6=E.stackAlloc=E.asm.n).apply(null,arguments)};E.allocate=fn;E.UTF8ToString=vn;E.ALLOC_NORMAL=jn;var MA;function Xn(A){this.name="ExitStatus",this.message="Program terminated with exit("+A+")",this.status=A}HA=function A(){if(!MA)Kj();if(!MA)HA=A};function Kj(A){if(A=A||wA,EA>0)return;if(kn(),EA>0)return;function j(){if(MA)return;if(MA=!0,E.calledRun=!0,n6)return;if($n(),E.onRuntimeInitialized)E.onRuntimeInitialized();In()}if(E.setStatus)E.setStatus("Running..."),setTimeout(function(){setTimeout(function(){E.setStatus("")},1),j()},1);else j()}E.run=Kj;if(E.preInit){if(typeof E.preInit=="function")E.preInit=[E.preInit];while(E.preInit.length>0)E.preInit.pop()()}Kj();if(typeof $A!=="undefined")$A.exports=E;E.unloadRuntime=function(){if(typeof self!=="undefined")delete self.Module;if(E=p6=TA=CA=gn=Pj=f6=kA=i6=q6=v6=r6=E6=k6=void 0,typeof $A!=="undefined")delete $A.exports}});var U6=oA((Ef,Vn)=>{Vn.exports="./argon2.wasm"});var t6=oA((e6,lA)=>{(function(A,j){if(typeof define==="function"&&define.amd)define([],j);else if(typeof lA==="object"&&lA.exports)lA.exports=j();else A.argon2=j()})(typeof self!=="undefined"?self:e6,function(){let A=typeof self!=="undefined"?self:this,j={Argon2d:0,Argon2i:1,Argon2id:2};function n($){if(n._promise)return n._promise;if(n._module)return Promise.resolve(n._module);let R;if(A.process&&A.process.versions&&A.process.versions.node)R=i().then((P)=>new Promise((U)=>{P.postRun=()=>U(P)}));else R=q().then((P)=>{let U=$?r($):void 0;return f(P,U)});return n._promise=R,R.then((P)=>{return n._module=P,delete n._promise,P})}function f($,R){return new Promise((P)=>{return A.Module={wasmBinary:$,wasmMemory:R,postRun(){P(Module)}},i()})}function i(){if(A.loadArgon2WasmModule)return A.loadArgon2WasmModule();return Promise.resolve(_j())}function q(){if(A.loadArgon2WasmBinary)return A.loadArgon2WasmBinary();return Promise.resolve(U6()).then((R)=>{return v(R)})}function v($){let R=atob($),P=new Uint8Array(new ArrayBuffer(R.length));for(let U=0;U<R.length;U++)P[U]=R.charCodeAt(U);return P}function r($){let Q=Math.min(Math.max(Math.ceil($*1024/65536),256)+256,32767);return new WebAssembly.Memory({initial:Q,maximum:32767})}function k($,R){return $.allocate(R,"i8",$.ALLOC_NORMAL)}function F($,R){let P=new Uint8Array([...R,0]);return k($,P)}function I($){if(typeof $!=="string")return $;if(typeof TextEncoder==="function")return new TextEncoder().encode($);else if(typeof Buffer==="function")return Buffer.from($);else throw new Error("Don't know how to encode UTF8")}function _($){let R=$.mem||1024;return n(R).then((P)=>{let U=$.time||1,H=$.parallelism||1,J=I($.pass),Q=F(P,J),u=J.length,Z=I($.salt),L=F(P,Z),m=Z.length,T=$.type||j.Argon2d,B=P.allocate(new Array($.hashLen||24),"i8",P.ALLOC_NORMAL),g=$.secret?k(P,$.secret):0,S=$.secret?$.secret.byteLength:0,w=$.ad?k(P,$.ad):0,V=$.ad?$.ad.byteLength:0,N=$.hashLen||24,X=P._argon2_encodedlen(U,R,H,m,N,T),W=P.allocate(new Array(X+1),"i8",P.ALLOC_NORMAL),K=19,z,Y;try{Y=P._argon2_hash_ext(U,R,H,Q,u,L,m,B,N,W,X,T,g,S,w,V,19)}catch(O){z=O}let D;if(Y===0&&!z){let O="",y=new Uint8Array(N);for(let o=0;o<N;o++){let p=P.HEAP8[B+o];y[o]=p,O+=("0"+(255&p).toString(16)).slice(-2)}let nA=P.UTF8ToString(W);D={hash:y,hashHex:O,encoded:nA}}else{try{if(!z)z=P.UTF8ToString(P._argon2_error_message(Y))}catch(O){}D={message:z,code:Y}}try{if(P._free(Q),P._free(L),P._free(B),P._free(W),w)P._free(w);if(g)P._free(g)}catch(O){}if(z)throw D;else return D})}function t($){return n().then((R)=>{let P=I($.pass),U=F(R,P),H=P.length,J=$.secret?k(R,$.secret):0,Q=$.secret?$.secret.byteLength:0,u=$.ad?k(R,$.ad):0,Z=$.ad?$.ad.byteLength:0,L=I($.encoded),m=F(R,L),T=$.type;if(T===void 0){let w=$.encoded.split("$")[1];if(w)w=w.replace("a","A"),T=j[w]||j.Argon2d}let B,g;try{g=R._argon2_verify_ext(m,U,H,J,Q,u,Z,T)}catch(w){B=w}let S;if(g||B){try{if(!B)B=R.UTF8ToString(R._argon2_error_message(g))}catch(w){}S={message:B,code:g}}try{R._free(U),R._free(m)}catch(w){}if(B)throw S;else return S})}function e(){if(n._module)n._module.unloadRuntime(),delete n._promise,delete n._module}return{ArgonType:j,hash:_,verify:t,unloadRuntime:e}})});class a extends Error{constructor(A){super(A);Object.setPrototypeOf(this,new.target.prototype),this.name=new.target.name,this.stack=void 0}}class fA extends a{}class UA extends a{}class hA extends a{}class WA extends a{}class PA extends a{}class x extends a{}class JA extends a{}class l extends a{}class c{static byId=new Map;static register(A){if(this.byId.has(A.id))throw new WA(`Scheme ${A.id} already registered`);this.byId.set(A.id,A)}static get(A){let j=this.byId.get(A);if(!j)throw new WA(`Unknown scheme: ${A}`);return j}static get current(){return this.get(0)}}class pA{p;key;constructor(A){this.p=A}async setKey(A){this.key=A}async encryptChunk(A){let j=this.p.getRandomValues(new Uint8Array(12)),n=new Uint8Array(await this.p.subtle.encrypt({name:"AES-GCM",iv:j},this.key,A));A.fill(0);let f=new Uint8Array(j.length+n.length);return f.set(j),f.set(n,j.length),f}async decryptChunk(A){let j=A.slice(0,12),n=A.slice(12);try{let f=await this.p.subtle.decrypt({name:"AES-GCM",iv:j},this.key,n);return new Uint8Array(f)}catch{throw new l("Decryption failed: wrong passphrase or corrupted ciphertext")}}}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function gj(A){return A instanceof Uint8Array||ArrayBuffer.isView(A)&&A.constructor.name==="Uint8Array"}function XA(A){if(typeof A!=="boolean")throw new Error(`boolean expected, not ${A}`)}function VA(A){if(!Number.isSafeInteger(A)||A<0)throw new Error("positive integer expected, got "+A)}function M(A,...j){if(!gj(A))throw new Error("Uint8Array expected");if(j.length>0&&!j.includes(A.length))throw new Error("Uint8Array expected of length "+j+", got length="+A.length)}function aA(A,j=!0){if(A.destroyed)throw new Error("Hash instance has been destroyed");if(j&&A.finished)throw new Error("Hash#digest() has already been called")}function Tj(A,j){M(A);let n=j.outputLen;if(A.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function AA(A){return new Uint32Array(A.buffer,A.byteOffset,Math.floor(A.byteLength/4))}function jA(...A){for(let j=0;j<A.length;j++)A[j].fill(0)}function X6(A){return new DataView(A.buffer,A.byteOffset,A.byteLength)}var V6=(()=>new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68)();function Y6(A){if(typeof A!=="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(A))}function YA(A){if(typeof A==="string")A=Y6(A);else if(gj(A))A=QA(A);else throw new Error("Uint8Array expected, got "+typeof A);return A}function mj(A,j){if(j==null||typeof j!=="object")throw new Error("options must be defined");return Object.assign(A,j)}function Sj(A,j){if(A.length!==j.length)return!1;let n=0;for(let f=0;f<A.length;f++)n|=A[f]^j[f];return n===0}var xA=(A,j)=>{function n(f,...i){if(M(f),!V6)throw new Error("Non little-endian hardware is not yet supported");if(A.nonceLength!==void 0){let I=i[0];if(!I)throw new Error("nonce / iv required");if(A.varSizeNonce)M(I);else M(I,A.nonceLength)}let q=A.tagLength;if(q&&i[1]!==void 0)M(i[1]);let v=j(f,...i),r=(I,_)=>{if(_!==void 0){if(I!==2)throw new Error("cipher output not supported");M(_)}},k=!1;return{encrypt(I,_){if(k)throw new Error("cannot encrypt() twice with same key + nonce");return k=!0,M(I),r(v.encrypt.length,_),v.encrypt(I,_)},decrypt(I,_){if(M(I),q&&I.length<q)throw new Error("invalid ciphertext length: smaller than tagLength="+q);return r(v.decrypt.length,_),v.decrypt(I,_)}}}return Object.assign(n,A),n};function Aj(A,j,n=!0){if(j===void 0)return new Uint8Array(A);if(j.length!==A)throw new Error("invalid output length, expected "+A+", got: "+j.length);if(n&&!Q6(j))throw new Error("invalid output, must be aligned");return j}function Hj(A,j,n,f){if(typeof A.setBigUint64==="function")return A.setBigUint64(j,n,f);let i=BigInt(32),q=BigInt(4294967295),v=Number(n>>i&q),r=Number(n&q),k=f?4:0,F=f?0:4;A.setUint32(j+k,v,f),A.setUint32(j+F,r,f)}function Oj(A,j,n){XA(n);let f=new Uint8Array(16),i=X6(f);return Hj(i,0,BigInt(j),n),Hj(i,8,BigInt(A),n),f}function Q6(A){return A.byteOffset%4===0}function QA(A){return Uint8Array.from(A)}var zj=(A)=>Uint8Array.from(A.split("").map((j)=>j.charCodeAt(0))),D6=zj("expand 16-byte k"),Z6=zj("expand 32-byte k"),L6=AA(D6),C6=AA(Z6);function G(A,j){return A<<j|A>>>32-j}function jj(A){return A.byteOffset%4===0}var DA=64,M6=16,Wj=4294967295,Nj=new Uint32Array;function c6(A,j,n,f,i,q,v,r){let k=i.length,F=new Uint8Array(DA),I=AA(F),_=jj(i)&&jj(q),t=_?AA(i):Nj,e=_?AA(q):Nj;for(let $=0;$<k;v++){if(A(j,n,f,I,v,r),v>=Wj)throw new Error("arx: counter overflow");let R=Math.min(DA,k-$);if(_&&R===DA){let P=$/4;if($%4!==0)throw new Error("arx: invalid block position");for(let U=0,H;U<M6;U++)H=P+U,e[H]=t[H]^I[U];$+=DA;continue}for(let P=0,U;P<R;P++)U=$+P,q[U]=i[U]^F[P];$+=R}}function nj(A,j){let{allowShortKeys:n,extendNonceFn:f,counterLength:i,counterRight:q,rounds:v}=mj({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},j);if(typeof A!=="function")throw new Error("core must be a function");return VA(i),VA(v),XA(q),XA(n),(r,k,F,I,_=0)=>{M(r),M(k),M(F);let t=F.length;if(I===void 0)I=new Uint8Array(t);if(M(I),VA(_),_<0||_>=Wj)throw new Error("arx: counter overflow");if(I.length<t)throw new Error(`arx: output (${I.length}) is shorter than data (${t})`);let e=[],$=r.length,R,P;if($===32)e.push(R=QA(r)),P=C6;else if($===16&&n)R=new Uint8Array(32),R.set(r),R.set(r,16),P=L6,e.push(R);else throw new Error(`arx: invalid 32-byte key, got length=${$}`);if(!jj(k))e.push(k=QA(k));let U=AA(R);if(f){if(k.length!==24)throw new Error("arx: extended nonce must be 24 bytes");f(P,U,AA(k.subarray(0,16)),U),k=k.subarray(16)}let H=16-i;if(H!==k.length)throw new Error(`arx: nonce must be ${H} or 16 bytes`);if(H!==12){let Q=new Uint8Array(12);Q.set(k,q?0:12-k.length),k=Q,e.push(k)}let J=AA(k);return c6(A,P,U,J,F,I,_,v),jA(...e),I}}var C=(A,j)=>A[j++]&255|(A[j++]&255)<<8;class Jj{constructor(A){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,A=YA(A),M(A,32);let j=C(A,0),n=C(A,2),f=C(A,4),i=C(A,6),q=C(A,8),v=C(A,10),r=C(A,12),k=C(A,14);this.r[0]=j&8191,this.r[1]=(j>>>13|n<<3)&8191,this.r[2]=(n>>>10|f<<6)&7939,this.r[3]=(f>>>7|i<<9)&8191,this.r[4]=(i>>>4|q<<12)&255,this.r[5]=q>>>1&8190,this.r[6]=(q>>>14|v<<2)&8191,this.r[7]=(v>>>11|r<<5)&8065,this.r[8]=(r>>>8|k<<8)&8191,this.r[9]=k>>>5&127;for(let F=0;F<8;F++)this.pad[F]=C(A,16+2*F)}process(A,j,n=!1){let f=n?0:2048,{h:i,r:q}=this,v=q[0],r=q[1],k=q[2],F=q[3],I=q[4],_=q[5],t=q[6],e=q[7],$=q[8],R=q[9],P=C(A,j+0),U=C(A,j+2),H=C(A,j+4),J=C(A,j+6),Q=C(A,j+8),u=C(A,j+10),Z=C(A,j+12),L=C(A,j+14),m=i[0]+(P&8191),T=i[1]+((P>>>13|U<<3)&8191),B=i[2]+((U>>>10|H<<6)&8191),g=i[3]+((H>>>7|J<<9)&8191),S=i[4]+((J>>>4|Q<<12)&8191),w=i[5]+(Q>>>1&8191),V=i[6]+((Q>>>14|u<<2)&8191),N=i[7]+((u>>>11|Z<<5)&8191),X=i[8]+((Z>>>8|L<<8)&8191),W=i[9]+(L>>>5|f),K=0,z=K+m*v+T*(5*R)+B*(5*$)+g*(5*e)+S*(5*t);K=z>>>13,z&=8191,z+=w*(5*_)+V*(5*I)+N*(5*F)+X*(5*k)+W*(5*r),K+=z>>>13,z&=8191;let Y=K+m*r+T*v+B*(5*R)+g*(5*$)+S*(5*e);K=Y>>>13,Y&=8191,Y+=w*(5*t)+V*(5*_)+N*(5*I)+X*(5*F)+W*(5*k),K+=Y>>>13,Y&=8191;let D=K+m*k+T*r+B*v+g*(5*R)+S*(5*$);K=D>>>13,D&=8191,D+=w*(5*e)+V*(5*t)+N*(5*_)+X*(5*I)+W*(5*F),K+=D>>>13,D&=8191;let O=K+m*F+T*k+B*r+g*v+S*(5*R);K=O>>>13,O&=8191,O+=w*(5*$)+V*(5*e)+N*(5*t)+X*(5*_)+W*(5*I),K+=O>>>13,O&=8191;let y=K+m*I+T*F+B*k+g*r+S*v;K=y>>>13,y&=8191,y+=w*(5*R)+V*(5*$)+N*(5*e)+X*(5*t)+W*(5*_),K+=y>>>13,y&=8191;let nA=K+m*_+T*I+B*F+g*k+S*r;K=nA>>>13,nA&=8191,nA+=w*v+V*(5*R)+N*(5*$)+X*(5*e)+W*(5*t),K+=nA>>>13,nA&=8191;let o=K+m*t+T*_+B*I+g*F+S*k;K=o>>>13,o&=8191,o+=w*r+V*v+N*(5*R)+X*(5*$)+W*(5*e),K+=o>>>13,o&=8191;let p=K+m*e+T*t+B*_+g*I+S*F;K=p>>>13,p&=8191,p+=w*k+V*r+N*v+X*(5*R)+W*(5*$),K+=p>>>13,p&=8191;let FA=K+m*$+T*e+B*t+g*_+S*I;K=FA>>>13,FA&=8191,FA+=w*F+V*k+N*r+X*v+W*(5*R),K+=FA>>>13,FA&=8191;let RA=K+m*R+T*$+B*e+g*t+S*_;K=RA>>>13,RA&=8191,RA+=w*I+V*F+N*k+X*r+W*v,K+=RA>>>13,RA&=8191,K=(K<<2)+K|0,K=K+z|0,z=K&8191,K=K>>>13,Y+=K,i[0]=z,i[1]=Y,i[2]=D,i[3]=O,i[4]=y,i[5]=nA,i[6]=o,i[7]=p,i[8]=FA,i[9]=RA}finalize(){let{h:A,pad:j}=this,n=new Uint16Array(10),f=A[1]>>>13;A[1]&=8191;for(let v=2;v<10;v++)A[v]+=f,f=A[v]>>>13,A[v]&=8191;A[0]+=f*5,f=A[0]>>>13,A[0]&=8191,A[1]+=f,f=A[1]>>>13,A[1]&=8191,A[2]+=f,n[0]=A[0]+5,f=n[0]>>>13,n[0]&=8191;for(let v=1;v<10;v++)n[v]=A[v]+f,f=n[v]>>>13,n[v]&=8191;n[9]-=8192;let i=(f^1)-1;for(let v=0;v<10;v++)n[v]&=i;i=~i;for(let v=0;v<10;v++)A[v]=A[v]&i|n[v];A[0]=(A[0]|A[1]<<13)&65535,A[1]=(A[1]>>>3|A[2]<<10)&65535,A[2]=(A[2]>>>6|A[3]<<7)&65535,A[3]=(A[3]>>>9|A[4]<<4)&65535,A[4]=(A[4]>>>12|A[5]<<1|A[6]<<14)&65535,A[5]=(A[6]>>>2|A[7]<<11)&65535,A[6]=(A[7]>>>5|A[8]<<8)&65535,A[7]=(A[8]>>>8|A[9]<<5)&65535;let q=A[0]+j[0];A[0]=q&65535;for(let v=1;v<8;v++)q=(A[v]+j[v]|0)+(q>>>16)|0,A[v]=q&65535;jA(n)}update(A){aA(this),A=YA(A),M(A);let{buffer:j,blockLen:n}=this,f=A.length;for(let i=0;i<f;){let q=Math.min(n-this.pos,f-i);if(q===n){for(;n<=f-i;i+=n)this.process(A,i);continue}if(j.set(A.subarray(i,i+q),this.pos),this.pos+=q,i+=q,this.pos===n)this.process(j,0,!1),this.pos=0}return this}destroy(){jA(this.h,this.r,this.buffer,this.pad)}digestInto(A){aA(this),Tj(A,this),this.finished=!0;let{buffer:j,h:n}=this,{pos:f}=this;if(f){j[f++]=1;for(;f<16;f++)j[f]=0;this.process(j,0,!0)}this.finalize();let i=0;for(let q=0;q<8;q++)A[i++]=n[q]>>>0,A[i++]=n[q]>>>8;return A}digest(){let{buffer:A,outputLen:j}=this;this.digestInto(A);let n=A.slice(0,j);return this.destroy(),n}}function l6(A){let j=(f,i)=>A(i).update(YA(f)).digest(),n=A(new Uint8Array(32));return j.outputLen=n.outputLen,j.blockLen=n.blockLen,j.create=(f)=>A(f),j}var Xj=l6((A)=>new Jj(A));function Qj(A,j,n,f,i,q=20){let v=A[0],r=A[1],k=A[2],F=A[3],I=j[0],_=j[1],t=j[2],e=j[3],$=j[4],R=j[5],P=j[6],U=j[7],H=i,J=n[0],Q=n[1],u=n[2],Z=v,L=r,m=k,T=F,B=I,g=_,S=t,w=e,V=$,N=R,X=P,W=U,K=H,z=J,Y=Q,D=u;for(let y=0;y<q;y+=2)Z=Z+B|0,K=G(K^Z,16),V=V+K|0,B=G(B^V,12),Z=Z+B|0,K=G(K^Z,8),V=V+K|0,B=G(B^V,7),L=L+g|0,z=G(z^L,16),N=N+z|0,g=G(g^N,12),L=L+g|0,z=G(z^L,8),N=N+z|0,g=G(g^N,7),m=m+S|0,Y=G(Y^m,16),X=X+Y|0,S=G(S^X,12),m=m+S|0,Y=G(Y^m,8),X=X+Y|0,S=G(S^X,7),T=T+w|0,D=G(D^T,16),W=W+D|0,w=G(w^W,12),T=T+w|0,D=G(D^T,8),W=W+D|0,w=G(w^W,7),Z=Z+g|0,D=G(D^Z,16),X=X+D|0,g=G(g^X,12),Z=Z+g|0,D=G(D^Z,8),X=X+D|0,g=G(g^X,7),L=L+S|0,K=G(K^L,16),W=W+K|0,S=G(S^W,12),L=L+S|0,K=G(K^L,8),W=W+K|0,S=G(S^W,7),m=m+w|0,z=G(z^m,16),V=V+z|0,w=G(w^V,12),m=m+w|0,z=G(z^m,8),V=V+z|0,w=G(w^V,7),T=T+B|0,Y=G(Y^T,16),N=N+Y|0,B=G(B^N,12),T=T+B|0,Y=G(Y^T,8),N=N+Y|0,B=G(B^N,7);let O=0;f[O++]=v+Z|0,f[O++]=r+L|0,f[O++]=k+m|0,f[O++]=F+T|0,f[O++]=I+B|0,f[O++]=_+g|0,f[O++]=t+S|0,f[O++]=e+w|0,f[O++]=$+V|0,f[O++]=R+N|0,f[O++]=P+X|0,f[O++]=U+W|0,f[O++]=H+K|0,f[O++]=J+z|0,f[O++]=Q+Y|0,f[O++]=u+D|0}function b6(A,j,n,f){let i=A[0],q=A[1],v=A[2],r=A[3],k=j[0],F=j[1],I=j[2],_=j[3],t=j[4],e=j[5],$=j[6],R=j[7],P=n[0],U=n[1],H=n[2],J=n[3];for(let u=0;u<20;u+=2)i=i+k|0,P=G(P^i,16),t=t+P|0,k=G(k^t,12),i=i+k|0,P=G(P^i,8),t=t+P|0,k=G(k^t,7),q=q+F|0,U=G(U^q,16),e=e+U|0,F=G(F^e,12),q=q+F|0,U=G(U^q,8),e=e+U|0,F=G(F^e,7),v=v+I|0,H=G(H^v,16),$=$+H|0,I=G(I^$,12),v=v+I|0,H=G(H^v,8),$=$+H|0,I=G(I^$,7),r=r+_|0,J=G(J^r,16),R=R+J|0,_=G(_^R,12),r=r+_|0,J=G(J^r,8),R=R+J|0,_=G(_^R,7),i=i+F|0,J=G(J^i,16),$=$+J|0,F=G(F^$,12),i=i+F|0,J=G(J^i,8),$=$+J|0,F=G(F^$,7),q=q+I|0,P=G(P^q,16),R=R+P|0,I=G(I^R,12),q=q+I|0,P=G(P^q,8),R=R+P|0,I=G(I^R,7),v=v+_|0,U=G(U^v,16),t=t+U|0,_=G(_^t,12),v=v+_|0,U=G(U^v,8),t=t+U|0,_=G(_^t,7),r=r+k|0,H=G(H^r,16),e=e+H|0,k=G(k^e,12),r=r+k|0,H=G(H^r,8),e=e+H|0,k=G(k^e,7);let Q=0;f[Q++]=i,f[Q++]=q,f[Q++]=v,f[Q++]=r,f[Q++]=P,f[Q++]=U,f[Q++]=H,f[Q++]=J}var u6=nj(Qj,{counterRight:!1,counterLength:4,allowShortKeys:!1}),y6=nj(Qj,{counterRight:!1,counterLength:8,extendNonceFn:b6,allowShortKeys:!1});var s6=new Uint8Array(16),Vj=(A,j)=>{A.update(j);let n=j.length%16;if(n)A.update(s6.subarray(n))},o6=new Uint8Array(32);function Yj(A,j,n,f,i){let q=A(j,n,o6),v=Xj.create(q);if(i)Vj(v,i);Vj(v,f);let r=Oj(f.length,i?i.length:0,!0);v.update(r);let k=v.digest();return jA(q,r),k}var Dj=(A)=>(j,n,f)=>{return{encrypt(q,v){let r=q.length;v=Aj(r+16,v,!1),v.set(q);let k=v.subarray(0,-16);A(j,n,k,k,1);let F=Yj(A,j,n,k,f);return v.set(F,r),jA(F),v},decrypt(q,v){v=Aj(q.length-16,v,!1);let r=q.subarray(0,-16),k=q.subarray(-16),F=Yj(A,j,n,r,f);if(!Sj(k,F))throw new Error("invalid tag");return v.set(q.subarray(0,-16)),A(j,n,v,v,1),jA(F),v}}},an=xA({blockSize:64,nonceLength:12,tagLength:16},Dj(u6)),fj=xA({blockSize:64,nonceLength:24,tagLength:16},Dj(y6));class ij{p;key;constructor(A){this.p=A}async setKey(A){this.key=new Uint8Array(await this.p.subtle.exportKey("raw",A))}async encryptChunk(A){let j=this.p.getRandomValues(new Uint8Array(24)),f=fj(this.key,j).encrypt(A);A.fill(0);let i=new Uint8Array(j.length+f.length);return i.set(j,0),i.set(f,j.length),i}async decryptChunk(A){let j=A.slice(0,24),n=A.slice(24),f=fj(this.key,j);try{return f.decrypt(n)}catch{throw new l("Decryption failed: wrong passphrase or corrupted ciphertext")}}}var bA=sA(t6(),1);async function w6(A,j,n,f){if(f==="node"){let i=await import("argon2"),q=typeof A==="string"?Buffer.from(A,"utf8"):Buffer.from(A),v=Buffer.from(j),r=await i.hash(q,{salt:v,timeCost:n.time,memoryCost:n.mem,parallelism:n.parallelism,hashLength:32,raw:!0,type:i.argon2id});return v.fill(0),q.fill(0),{hash:new Uint8Array(r)}}if(f==="browser"){if(!("loadArgon2WasmBinary"in globalThis))globalThis.loadArgon2WasmBinary=()=>fetch("argon2.wasm").then((i)=>{if(!i.ok)throw new Error("Failed to load argon2.wasm");return i.arrayBuffer()}).then((i)=>new Uint8Array(i));return bA.hash({pass:A,salt:j,time:n.time,mem:n.mem,parallelism:n.parallelism,hashLen:32,type:bA.ArgonType.Argon2id}).then((i)=>{if(!i||!i.hash)throw new x("Failed to produce key derivation");return{hash:i.hash}}).catch((i)=>{let q=i instanceof Error?i.message:typeof i==="string"?i:"Unknown error";throw new x(`argon2-browser failure: ${q}`)})}throw new Error(`Unsupported environment: ${f}`)}class uA{presets;exportExtractable;name="argon2id";constructor(A,j=!1){this.presets=A;this.exportExtractable=j}async derive(A,j,n,f){let{hash:i}=await w6(A,j,this.presets[n],f.isNode?"node":"browser");if(this.exportExtractable)return f.subtle.importKey("raw",i,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);else return f.subtle.importKey("raw",i,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}}var B6={low:{time:5,mem:65536,parallelism:1},middle:{time:20,mem:65536,parallelism:1},high:{time:40,mem:65536,parallelism:1}},Yn={id:0,cipher:pA,kdf:new uA(B6),saltLengths:{low:12,high:16},difficulties:B6,defaultChunkSize:524288};c.register(Yn);var H6={low:{time:5,mem:65536,parallelism:2},middle:{time:10,mem:98304,parallelism:4},high:{time:20,mem:98304,parallelism:4}},Qn={id:1,cipher:ij,kdf:new uA(H6,!0),saltLengths:{low:12,high:16},difficulties:H6,defaultChunkSize:524288};c.register(Qn);var yA=1;function g6(){return typeof process!=="undefined"&&typeof process.versions==="object"&&!1}function SA(...A){let j=A.reduce((i,q)=>i+q.byteLength,0),n=new Uint8Array(j),f=0;for(let i of A)n.set(i,f),f+=i.byteLength;return n}function OA(...A){try{let j=SA(...A);if(g6())return Buffer.from(j).toString("base64");let n="";for(let f=0;f<j.length;f++)n+=String.fromCharCode(j[f]);return btoa(n)}catch(j){throw new hA("Base64 Enconding Error")}}function Uj(A){try{if(!/^[A-Za-z0-9+/]+={0,2}$/.test(A)||A.length%4!==0)throw new Error("invalid base64");if(g6())return new Uint8Array(Buffer.from(A,"base64"));let j=atob(A),n=new Uint8Array(j.length);for(let f=0;f<j.length;f++)n[f]=j.charCodeAt(f);return n}catch(j){throw new UA(`Invalid Base64: length=${A.length}, content='${A.slice(0,12)}…'`)}}function d(A){let j=A.length,n=new Uint8Array(j);return crypto.getRandomValues(n),Array.from(n,(f)=>String.fromCharCode(33+f%94)).join("")}function NA(A,j,n,f){let i={low:0,middle:1,high:2}[j]??0,q=A<<5|(n==="high"?1:0)<<2|i;return SA(new Uint8Array([yA,q]),f)}function IA(A){if(A[0]!==yA)throw new fA("Invalid input format. The input is unknown.");try{let j=A[1],n=j>>5,f=j>>2&1?"high":"low",i=j&3,q=["low","middle","high"][i],v=c.get(n).saltLengths[f],r=A.slice(2,2+v);return{scheme:n,difficulty:q,saltStrength:f,salt:r,headerLen:2+v}}catch(j){throw new PA(j instanceof Error?j.message:String(j))}}class zA{engine;chunkSize;buffer=new Uint8Array(0);constructor(A,j=524288){this.engine=A;this.chunkSize=j}toTransformStream(){return new TransformStream({transform:async(A,j)=>{await this.transform(await this.asUint8Array(A),j)},flush:async(A)=>this.flush(A)})}async transform(A,j){let n=new Uint8Array(this.buffer.length+A.length);n.set(this.buffer),n.set(A,this.buffer.length);let f=0;while(n.length-f>=this.chunkSize){let i=n.slice(f,f+this.chunkSize);f+=this.chunkSize;let q=await this.engine.encryptChunk(i),v=new Uint8Array(4);new DataView(v.buffer).setUint32(0,q.length,!1);let r=new Uint8Array(4+q.length);r.set(v),r.set(q,v.length),j.enqueue(r)}this.buffer=n.slice(f)}async flush(A){if(!this.buffer.length)return;let j=await this.engine.encryptChunk(this.buffer),n=new Uint8Array(4);new DataView(n.buffer).setUint32(0,j.length,!1);let f=new Uint8Array(4+j.length);f.set(n),f.set(j,4),A.enqueue(f),this.buffer=new Uint8Array(0)}async asUint8Array(A){if(A instanceof Uint8Array)return A;if(A instanceof ArrayBuffer)return new Uint8Array(A);return new Uint8Array(await A.arrayBuffer())}}class GA{engine;chunkSize;buffer=new Uint8Array(0);constructor(A,j=524288){this.engine=A;this.chunkSize=j}toTransformStream(){return new TransformStream({transform:async(A,j)=>{await this.transform(await this.asUint8Array(A),j)},flush:async(A)=>this.flush(A)})}async transform(A,j){let n=new Uint8Array(this.buffer.length+A.length);n.set(this.buffer),n.set(A,this.buffer.length);let f=0;while(!0){if(n.length-f<4)break;let i=new DataView(n.buffer,n.byteOffset+f,4).getUint32(0,!1);if(i>this.chunkSize*2)throw new l(`Frame length ${i} exceeds maximum allowed ${this.chunkSize*2}`);if(n.length-f-4<i)break;f+=4;let q=n.slice(f,f+i);f+=i;try{let v=await this.engine.decryptChunk(q);j.enqueue(v)}catch(v){throw v instanceof l?v:new l("Decryption failed: Wrong passphrase or corrupted ciphertext")}}this.buffer=n.slice(f)}async flush(A){await this.transform(new Uint8Array(0),A),this.buffer=new Uint8Array(0)}async asUint8Array(A){if(A instanceof Uint8Array)return A;if(A instanceof ArrayBuffer)return new Uint8Array(A);return new Uint8Array(await A.arrayBuffer())}}class KA{engine;chunkSize;constructor(A,j=524288){this.engine=A;this.chunkSize=j}encryptionStream(){let A=new zA(this.engine,this.chunkSize).toTransformStream();return{writable:A.writable,readable:A.readable}}decryptionStream(A){let j=A,n=new TransformStream({transform(i,q){if(j===0){q.enqueue(i);return}if(i.byteLength<=j){j-=i.byteLength;return}q.enqueue(i.slice(j)),j=0}}),f=new GA(this.engine,this.chunkSize).toTransformStream();return{writable:n.writable,readable:n.readable.pipeThrough(f)}}async collect(A,j,n=null){let f=A.pipeThrough(j).getReader(),i=[];if(n?.length)i.push(n);try{while(!0){let{value:k,done:F}=await f.read();if(F)break;i.push(k)}await f.closed}finally{f.releaseLock()}let q=i.reduce((k,F)=>k+F.byteLength,0),v=new Uint8Array(q),r=0;for(let k of i)v.set(k,r),r+=k.byteLength;return v}}function T6(A=0,j=console.info){return{level:A,log(n,f){if(n<=A)j(`${n}| ${f}`)}}}var m6=new WeakMap;class qA{static getEngine(A,j){let n=m6.get(A);if(!n)n=new Map,m6.set(A,n);let f=n.get(j);if(f)return f;let i=c.get(j);return f={desc:i,cipher:new i.cipher(A),kdf:i.kdf,chunkSize:i.defaultChunkSize,provider:A},n.set(j,f),f}static async deriveKey(A,j,n,f){try{let i=await A.kdf.derive(j,n,f,A.provider);j=d(j),j=null,await A.cipher.setKey(i)}catch(i){let q=i instanceof Error?i.message:String(i);throw new x(q)}}}class vA{provider;v;cipher;kdf;chunkSize;stream;difficulty;saltStrength;engines=new Map;log;constructor(A,j={}){this.provider=A;this.v=c.get(j.scheme??c.current.id),this.cipher=new this.v.cipher(A),this.kdf=this.v.kdf,this.chunkSize=j.chunkSize??this.v.defaultChunkSize,this.stream=new KA(this.cipher,this.chunkSize),this.difficulty=j.difficulty??"middle",this.saltStrength=j.saltStrength??"high",this.log=T6(j.verbose??0,j.logger)}static async isEncrypted(A){try{return await vA.peekHeader(A),!0}catch{return!1}}static async headerDecode(A){let j=await vA.peekHeader(A),n=IA(j);return{scheme:n.scheme,difficulty:n.difficulty,salt:OA(n.salt),saltLength:n.salt.byteLength}}setDifficulty(A){this.difficulty=A}getDifficulty(){return this.difficulty}setScheme(A){this.v=c.get(A),this.cipher=new this.v.cipher(this.provider),this.kdf=this.v.kdf,this.stream=new KA(this.cipher,this.chunkSize)}getScheme(){return this.v.id}setSaltDifficulty(A){this.saltStrength=A}getSaltDifficulty(){return this.saltStrength}setChunkSize(A){this.chunkSize=A,this.stream=new KA(this.cipher,this.chunkSize)}getChunkSize(){return this.chunkSize}setVerbose(A){this.log.level=A}getVerbose(){return this.log.level}async encryptText(A,j){try{this.log.log(1,`Start text encryption, scheme: ${this.getScheme()}`),this.log.log(2,"Deriving key for text encryption");let n=this.genSalt();await this.deriveKey(j,n),j=d(j),j=null,this.log.log(3,`Salt generated: ${OA(n)}, KDF difficulty: ${this.difficulty}`),this.log.log(2,"Encrypting text data");let f=await this.cipher.encryptChunk(typeof A==="string"?new TextEncoder().encode(A):A);this.log.log(3,"Encoding header");let i=NA(this.v.id,this.difficulty,this.saltStrength,n);this.log.log(3,"Encoding text");let q=OA(i,f);return this.log.log(1,"Decryption finished"),q}catch(n){throw new JA(n instanceof Error?n.message:String(n))}}async decryptText(A,j){try{this.log.log(1,`Start text decryption, Version ${this.getScheme()}`),this.log.log(3,"Start text decoding");let n=Uj(A);this.log.log(3,"Start header decoding"),await vA.peekHeader(A);let f=IA(n);this.log.log(3,"Trying to get engine");let i=qA.getEngine(this.provider,f.scheme);this.log.log(2,`Deriving key via engine for scheme: ${f.scheme}`),this.log.log(3,`Salt use: ${OA(f.salt)}, KDF difficulty: ${f.difficulty}`),await qA.deriveKey(i,j,f.salt,f.difficulty),j=d(j),j=null,this.log.log(2,"Decrypting text data");let q=await i.cipher.decryptChunk(n.slice(f.headerLen));this.log.log(3,"Decoding text");let v=new TextDecoder().decode(q);return this.log.log(1,"Decryption finished"),v}catch(n){if(n instanceof l||n instanceof fA||n instanceof PA||n instanceof UA||n instanceof x)throw n;throw new l("Decryption failed: wrong passphrase or corrupted ciphertext")}}async encryptFile(A,j){try{if(A.size===0){let q=this.genSalt();await this.deriveKey(j,q),j=d(j),j=null;let v=NA(this.v.id,this.difficulty,this.saltStrength,q);return new Blob([v],{type:"application/octet-stream"})}this.log.log(2,"Deriving key for file encryption");let n=this.genSalt();await this.deriveKey(j,n),j=d(j),j=null;let f=NA(this.v.id,this.difficulty,this.saltStrength,n),i=await this.stream.collect(A.stream(),new zA(this.cipher,this.chunkSize).toTransformStream(),f);return new Blob([i],{type:"application/octet-stream"})}catch(n){throw new JA(n instanceof Error?n.message:String(n))}}async decryptFile(A,j){try{let n=await vA.peekHeader(A),f=IA(n),i=qA.getEngine(this.provider,f.scheme);if(await qA.deriveKey(i,j,f.salt,f.difficulty),j=d(j),j=null,A.size===f.headerLen)return new Blob([],{type:"application/octet-stream"});this.log.log(2,"Decrypting file data");let v=await new KA(i.cipher,i.chunkSize).collect(A.slice(f.headerLen).stream(),new GA(i.cipher,i.chunkSize).toTransformStream());return new Blob([v],{type:"application/octet-stream"})}catch(n){if(n instanceof l)throw n;throw new l(n instanceof Error?n.message:String(n))}}async createEncryptionStream(A){this.log.log(2,"Deriving key for stream encryption");let j=this.genSalt();await this.deriveKey(A,j),A=d(A),A=null;let n=NA(this.v.id,this.difficulty,this.saltStrength,j),f=this.stream.encryptionStream();return{header:n,writable:f.writable,readable:f.readable}}async createDecryptionStream(A){let j=this,n=new Uint8Array(0),f=null;async function i(q,v){let r=q.getReader();while(!0){let{value:k,done:F}=await r.read();if(F)break;v.enqueue(k)}}return new TransformStream({async transform(q,v){if(!f){if(n=SA(n,q),n.length<2)return;let k=n.slice(0,30),{salt:F,difficulty:I}=IA(k),_=n[1]>>5,t=n[1]>>2&1?"high":"low",$=2+c.get(_).saltLengths[t];if(n.length<$)return;let R=qA.getEngine(j.provider,_);await qA.deriveKey(R,A,F,I),A=d(A),A=null,f=new GA(R.cipher,R.chunkSize).toTransformStream(),i(f.readable,v);let P=n.slice($);if(P.length){let U=f.writable.getWriter();await U.write(P),U.releaseLock()}return}let r=f.writable.getWriter();await r.write(q),r.releaseLock()},async flush(){if(f){let q=f.writable.getWriter();await q.close(),q.releaseLock()}}})}async deriveKey(A,j,n=this.difficulty){let f=performance.now();try{let i=await this.kdf.derive(A,j,n,this.provider);A=d(A),A=null,await this.cipher.setKey(i),this.log.log(3,`Key derivation completed in ${(performance.now()-f).toFixed(1)} ms`)}catch(i){throw new x(i instanceof Error?i.message:String(i))}}genSalt(){let A=this.v.saltLengths[this.saltStrength];return this.provider.getRandomValues(new Uint8Array(A))}static async peekHeader(A){if(typeof A==="string")A=Uj(A);if(A instanceof Uint8Array){if(A.length<2)throw new fA("Input too short");let{headerLen:j}=IA(A.length>=16?A:Uint8Array.from(A));if(A.length<j)throw new fA("Incomplete header");return A.slice(0,j)}if(A instanceof Blob){let j=new Uint8Array(await A.slice(0,2).arrayBuffer());if(j[0]!==1)throw new fA("Invalid input format. The input is unknown.");let n=j[1],f=n>>5,i=n>>2&1?"high":"low",q=c.get(f).saltLengths[i],v=new Uint8Array(await A.slice(0,2+q).arrayBuffer());return IA(v),v}throw new PA("Unsupported input type")}}var S6={subtle:globalThis.crypto.subtle,getRandomValues(A){return globalThis.crypto.getRandomValues(A)},isNode:!1};function ji(A){return new vA(S6,A)}export{ji as createCryptit,vA as Cryptit};

//# debugId=28D08F1E75E4E44A64756E2164756E21
